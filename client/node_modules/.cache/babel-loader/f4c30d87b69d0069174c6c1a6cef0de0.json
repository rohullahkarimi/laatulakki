{"ast":null,"code":"var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, {\n  enumerable: true,\n  configurable: true,\n  writable: true,\n  value\n}) : obj[key] = value;\nvar __publicField = (obj, key, value) => {\n  __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n  return value;\n};\nimport { Matrix4, EventDispatcher, Vector2, Vector3, Quaternion, Group, EllipseCurve, BufferGeometry, PerspectiveCamera, MathUtils, OrthographicCamera, Box3, Sphere, GridHelper, LineBasicMaterial, Line, Raycaster } from \"three\";\nconst STATE = {\n  IDLE: Symbol(),\n  ROTATE: Symbol(),\n  PAN: Symbol(),\n  SCALE: Symbol(),\n  FOV: Symbol(),\n  FOCUS: Symbol(),\n  ZROTATE: Symbol(),\n  TOUCH_MULTI: Symbol(),\n  ANIMATION_FOCUS: Symbol(),\n  ANIMATION_ROTATE: Symbol()\n};\nconst INPUT = {\n  NONE: Symbol(),\n  ONE_FINGER: Symbol(),\n  ONE_FINGER_SWITCHED: Symbol(),\n  TWO_FINGER: Symbol(),\n  MULT_FINGER: Symbol(),\n  CURSOR: Symbol()\n};\nconst _center = {\n  x: 0,\n  y: 0\n};\nconst _transformation = {\n  camera: /* @__PURE__ */new Matrix4(),\n  gizmos: /* @__PURE__ */new Matrix4()\n};\nconst _changeEvent = {\n  type: \"change\"\n};\nconst _startEvent = {\n  type: \"start\"\n};\nconst _endEvent = {\n  type: \"end\"\n};\nclass ArcballControls extends EventDispatcher {\n  constructor(camera, domElement = null, scene = null) {\n    super();\n    __publicField(this, \"camera\");\n    __publicField(this, \"domElement\");\n    __publicField(this, \"scene\");\n    __publicField(this, \"mouseActions\");\n    __publicField(this, \"_mouseOp\");\n    __publicField(this, \"_v2_1\");\n    __publicField(this, \"_v3_1\");\n    __publicField(this, \"_v3_2\");\n    __publicField(this, \"_m4_1\");\n    __publicField(this, \"_m4_2\");\n    __publicField(this, \"_quat\");\n    __publicField(this, \"_translationMatrix\");\n    __publicField(this, \"_rotationMatrix\");\n    __publicField(this, \"_scaleMatrix\");\n    __publicField(this, \"_rotationAxis\");\n    __publicField(this, \"_cameraMatrixState\");\n    __publicField(this, \"_cameraProjectionState\");\n    __publicField(this, \"_fovState\");\n    __publicField(this, \"_upState\");\n    __publicField(this, \"_zoomState\");\n    __publicField(this, \"_nearPos\");\n    __publicField(this, \"_farPos\");\n    __publicField(this, \"_gizmoMatrixState\");\n    __publicField(this, \"_up0\");\n    __publicField(this, \"_zoom0\");\n    __publicField(this, \"_fov0\");\n    __publicField(this, \"_initialNear\");\n    __publicField(this, \"_nearPos0\");\n    __publicField(this, \"_initialFar\");\n    __publicField(this, \"_farPos0\");\n    __publicField(this, \"_cameraMatrixState0\");\n    __publicField(this, \"_gizmoMatrixState0\");\n    __publicField(this, \"_button\");\n    __publicField(this, \"_touchStart\");\n    __publicField(this, \"_touchCurrent\");\n    __publicField(this, \"_input\");\n    __publicField(this, \"_switchSensibility\");\n    __publicField(this, \"_startFingerDistance\");\n    __publicField(this, \"_currentFingerDistance\");\n    __publicField(this, \"_startFingerRotation\");\n    __publicField(this, \"_currentFingerRotation\");\n    __publicField(this, \"_devPxRatio\");\n    __publicField(this, \"_downValid\");\n    __publicField(this, \"_nclicks\");\n    __publicField(this, \"_downEvents\");\n    __publicField(this, \"_clickStart\");\n    __publicField(this, \"_maxDownTime\");\n    __publicField(this, \"_maxInterval\");\n    __publicField(this, \"_posThreshold\");\n    __publicField(this, \"_movementThreshold\");\n    __publicField(this, \"_currentCursorPosition\");\n    __publicField(this, \"_startCursorPosition\");\n    __publicField(this, \"_grid\");\n    __publicField(this, \"_gridPosition\");\n    __publicField(this, \"_gizmos\");\n    __publicField(this, \"_curvePts\");\n    __publicField(this, \"_timeStart\");\n    __publicField(this, \"_animationId\");\n    __publicField(this, \"focusAnimationTime\");\n    __publicField(this, \"_timePrev\");\n    __publicField(this, \"_timeCurrent\");\n    __publicField(this, \"_anglePrev\");\n    __publicField(this, \"_angleCurrent\");\n    __publicField(this, \"_cursorPosPrev\");\n    __publicField(this, \"_cursorPosCurr\");\n    __publicField(this, \"_wPrev\");\n    __publicField(this, \"_wCurr\");\n    __publicField(this, \"adjustNearFar\");\n    __publicField(this, \"scaleFactor\");\n    __publicField(this, \"dampingFactor\");\n    __publicField(this, \"wMax\");\n    __publicField(this, \"enableAnimations\");\n    __publicField(this, \"enableGrid\");\n    __publicField(this, \"cursorZoom\");\n    __publicField(this, \"minFov\");\n    __publicField(this, \"maxFov\");\n    __publicField(this, \"enabled\");\n    __publicField(this, \"enablePan\");\n    __publicField(this, \"enableRotate\");\n    __publicField(this, \"enableZoom\");\n    __publicField(this, \"minDistance\");\n    __publicField(this, \"maxDistance\");\n    __publicField(this, \"minZoom\");\n    __publicField(this, \"maxZoom\");\n    __publicField(this, \"target\");\n    __publicField(this, \"_currentTarget\");\n    __publicField(this, \"_tbRadius\");\n    __publicField(this, \"_state\");\n    //listeners\n    __publicField(this, \"onWindowResize\", () => {\n      const scale = (this._gizmos.scale.x + this._gizmos.scale.y + this._gizmos.scale.z) / 3;\n      if (this.camera) {\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n      }\n      const newRadius = this._tbRadius / scale;\n      const curve = new EllipseCurve(0, 0, newRadius, newRadius);\n      const points = curve.getPoints(this._curvePts);\n      const curveGeometry = new BufferGeometry().setFromPoints(points);\n      for (const gizmo in this._gizmos.children) {\n        const child = this._gizmos.children[gizmo];\n        child.geometry = curveGeometry;\n      }\n      this.dispatchEvent(_changeEvent);\n    });\n    __publicField(this, \"onContextMenu\", event => {\n      if (!this.enabled) {\n        return;\n      }\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        if (this.mouseActions[i].mouse == 2) {\n          event.preventDefault();\n          break;\n        }\n      }\n    });\n    __publicField(this, \"onPointerCancel\", () => {\n      this._touchStart.splice(0, this._touchStart.length);\n      this._touchCurrent.splice(0, this._touchCurrent.length);\n      this._input = INPUT.NONE;\n    });\n    __publicField(this, \"onPointerDown\", event => {\n      if (event.button == 0 && event.isPrimary) {\n        this._downValid = true;\n        this._downEvents.push(event);\n      } else {\n        this._downValid = false;\n      }\n      if (event.pointerType == \"touch\" && this._input != INPUT.CURSOR) {\n        this._touchStart.push(event);\n        this._touchCurrent.push(event);\n        switch (this._input) {\n          case INPUT.NONE:\n            this._input = INPUT.ONE_FINGER;\n            this.onSinglePanStart(event, \"ROTATE\");\n            window.addEventListener(\"pointermove\", this.onPointerMove);\n            window.addEventListener(\"pointerup\", this.onPointerUp);\n            break;\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            this._input = INPUT.TWO_FINGER;\n            this.onRotateStart();\n            this.onPinchStart();\n            this.onDoublePanStart();\n            break;\n          case INPUT.TWO_FINGER:\n            this._input = INPUT.MULT_FINGER;\n            this.onTriplePanStart();\n            break;\n        }\n      } else if (event.pointerType != \"touch\" && this._input == INPUT.NONE) {\n        let modifier = null;\n        if (event.ctrlKey || event.metaKey) {\n          modifier = \"CTRL\";\n        } else if (event.shiftKey) {\n          modifier = \"SHIFT\";\n        }\n        this._mouseOp = this.getOpFromAction(event.button, modifier);\n        if (this._mouseOp) {\n          window.addEventListener(\"pointermove\", this.onPointerMove);\n          window.addEventListener(\"pointerup\", this.onPointerUp);\n          this._input = INPUT.CURSOR;\n          this._button = event.button;\n          this.onSinglePanStart(event, this._mouseOp);\n        }\n      }\n    });\n    __publicField(this, \"onPointerMove\", event => {\n      if (event.pointerType == \"touch\" && this._input != INPUT.CURSOR) {\n        switch (this._input) {\n          case INPUT.ONE_FINGER:\n            this.updateTouchEvent(event);\n            this.onSinglePanMove(event, STATE.ROTATE);\n            break;\n          case INPUT.ONE_FINGER_SWITCHED:\n            const movement = this.calculatePointersDistance(this._touchCurrent[0], event) * this._devPxRatio;\n            if (movement >= this._switchSensibility) {\n              this._input = INPUT.ONE_FINGER;\n              this.updateTouchEvent(event);\n              this.onSinglePanStart(event, \"ROTATE\");\n              break;\n            }\n            break;\n          case INPUT.TWO_FINGER:\n            this.updateTouchEvent(event);\n            this.onRotateMove();\n            this.onPinchMove();\n            this.onDoublePanMove();\n            break;\n          case INPUT.MULT_FINGER:\n            this.updateTouchEvent(event);\n            this.onTriplePanMove();\n            break;\n        }\n      } else if (event.pointerType != \"touch\" && this._input == INPUT.CURSOR) {\n        let modifier = null;\n        if (event.ctrlKey || event.metaKey) {\n          modifier = \"CTRL\";\n        } else if (event.shiftKey) {\n          modifier = \"SHIFT\";\n        }\n        const mouseOpState = this.getOpStateFromAction(this._button, modifier);\n        if (mouseOpState) {\n          this.onSinglePanMove(event, mouseOpState);\n        }\n      }\n      if (this._downValid) {\n        const movement = this.calculatePointersDistance(this._downEvents[this._downEvents.length - 1], event) * this._devPxRatio;\n        if (movement > this._movementThreshold) {\n          this._downValid = false;\n        }\n      }\n    });\n    __publicField(this, \"onPointerUp\", event => {\n      if (event.pointerType == \"touch\" && this._input != INPUT.CURSOR) {\n        const nTouch = this._touchCurrent.length;\n        for (let i = 0; i < nTouch; i++) {\n          if (this._touchCurrent[i].pointerId == event.pointerId) {\n            this._touchCurrent.splice(i, 1);\n            this._touchStart.splice(i, 1);\n            break;\n          }\n        }\n        switch (this._input) {\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            window.removeEventListener(\"pointermove\", this.onPointerMove);\n            window.removeEventListener(\"pointerup\", this.onPointerUp);\n            this._input = INPUT.NONE;\n            this.onSinglePanEnd();\n            break;\n          case INPUT.TWO_FINGER:\n            this.onDoublePanEnd();\n            this.onPinchEnd();\n            this.onRotateEnd();\n            this._input = INPUT.ONE_FINGER_SWITCHED;\n            break;\n          case INPUT.MULT_FINGER:\n            if (this._touchCurrent.length == 0) {\n              window.removeEventListener(\"pointermove\", this.onPointerMove);\n              window.removeEventListener(\"pointerup\", this.onPointerUp);\n              this._input = INPUT.NONE;\n              this.onTriplePanEnd();\n            }\n            break;\n        }\n      } else if (event.pointerType != \"touch\" && this._input == INPUT.CURSOR) {\n        window.removeEventListener(\"pointermove\", this.onPointerMove);\n        window.removeEventListener(\"pointerup\", this.onPointerUp);\n        this._input = INPUT.NONE;\n        this.onSinglePanEnd();\n        this._button = -1;\n      }\n      if (event.isPrimary) {\n        if (this._downValid) {\n          const downTime = event.timeStamp - this._downEvents[this._downEvents.length - 1].timeStamp;\n          if (downTime <= this._maxDownTime) {\n            if (this._nclicks == 0) {\n              this._nclicks = 1;\n              this._clickStart = performance.now();\n            } else {\n              const clickInterval = event.timeStamp - this._clickStart;\n              const movement = this.calculatePointersDistance(this._downEvents[1], this._downEvents[0]) * this._devPxRatio;\n              if (clickInterval <= this._maxInterval && movement <= this._posThreshold) {\n                this._nclicks = 0;\n                this._downEvents.splice(0, this._downEvents.length);\n                this.onDoubleTap(event);\n              } else {\n                this._nclicks = 1;\n                this._downEvents.shift();\n                this._clickStart = performance.now();\n              }\n            }\n          } else {\n            this._downValid = false;\n            this._nclicks = 0;\n            this._downEvents.splice(0, this._downEvents.length);\n          }\n        } else {\n          this._nclicks = 0;\n          this._downEvents.splice(0, this._downEvents.length);\n        }\n      }\n    });\n    __publicField(this, \"onWheel\", event => {\n      var _a, _b;\n      if (this.enabled && this.enableZoom && this.domElement) {\n        let modifier = null;\n        if (event.ctrlKey || event.metaKey) {\n          modifier = \"CTRL\";\n        } else if (event.shiftKey) {\n          modifier = \"SHIFT\";\n        }\n        const mouseOp = this.getOpFromAction(\"WHEEL\", modifier);\n        if (mouseOp) {\n          event.preventDefault();\n          this.dispatchEvent(_startEvent);\n          const notchDeltaY = 125;\n          let sgn = event.deltaY / notchDeltaY;\n          let size = 1;\n          if (sgn > 0) {\n            size = 1 / this.scaleFactor;\n          } else if (sgn < 0) {\n            size = this.scaleFactor;\n          }\n          switch (mouseOp) {\n            case \"ZOOM\":\n              this.updateTbState(STATE.SCALE, true);\n              if (sgn > 0) {\n                size = 1 / Math.pow(this.scaleFactor, sgn);\n              } else if (sgn < 0) {\n                size = Math.pow(this.scaleFactor, -sgn);\n              }\n              if (this.cursorZoom && this.enablePan) {\n                let scalePoint;\n                if (this.camera instanceof OrthographicCamera) {\n                  scalePoint = (_a = this.unprojectOnTbPlane(this.camera, event.clientX, event.clientY, this.domElement)) == null ? void 0 : _a.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._gizmos.position);\n                }\n                if (this.camera instanceof PerspectiveCamera) {\n                  scalePoint = (_b = this.unprojectOnTbPlane(this.camera, event.clientX, event.clientY, this.domElement)) == null ? void 0 : _b.applyQuaternion(this.camera.quaternion).add(this._gizmos.position);\n                }\n                if (scalePoint !== void 0) this.applyTransformMatrix(this.applyScale(size, scalePoint));\n              } else {\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n              }\n              if (this._grid) {\n                this.disposeGrid();\n                this.drawGrid();\n              }\n              this.updateTbState(STATE.IDLE, false);\n              this.dispatchEvent(_changeEvent);\n              this.dispatchEvent(_endEvent);\n              break;\n            case \"FOV\":\n              if (this.camera instanceof PerspectiveCamera) {\n                this.updateTbState(STATE.FOV, true);\n                if (event.deltaX != 0) {\n                  sgn = event.deltaX / notchDeltaY;\n                  size = 1;\n                  if (sgn > 0) {\n                    size = 1 / Math.pow(this.scaleFactor, sgn);\n                  } else if (sgn < 0) {\n                    size = Math.pow(this.scaleFactor, -sgn);\n                  }\n                }\n                this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n                const x = this._v3_1.distanceTo(this._gizmos.position);\n                let xNew = x / size;\n                xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n                const y = x * Math.tan(MathUtils.DEG2RAD * this.camera.fov * 0.5);\n                let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2);\n                if (newFov > this.maxFov) {\n                  newFov = this.maxFov;\n                } else if (newFov < this.minFov) {\n                  newFov = this.minFov;\n                }\n                const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                size = x / newDistance;\n                this.setFov(newFov);\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position, false));\n              }\n              if (this._grid) {\n                this.disposeGrid();\n                this.drawGrid();\n              }\n              this.updateTbState(STATE.IDLE, false);\n              this.dispatchEvent(_changeEvent);\n              this.dispatchEvent(_endEvent);\n              break;\n          }\n        }\n      }\n    });\n    __publicField(this, \"onSinglePanStart\", (event, operation) => {\n      if (this.enabled && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.setCenter(event.clientX, event.clientY);\n        switch (operation) {\n          case \"PAN\":\n            if (!this.enablePan) return;\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n              this.activateGizmos(false);\n              this.dispatchEvent(_changeEvent);\n            }\n            if (this.camera) {\n              this.updateTbState(STATE.PAN, true);\n              const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n              if (rayDir !== void 0) {\n                this._startCursorPosition.copy(rayDir);\n              }\n              if (this.enableGrid) {\n                this.drawGrid();\n                this.dispatchEvent(_changeEvent);\n              }\n            }\n            break;\n          case \"ROTATE\":\n            if (!this.enableRotate) return;\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n            }\n            if (this.camera) {\n              this.updateTbState(STATE.ROTATE, true);\n              const rayDir = this.unprojectOnTbSurface(this.camera, _center.x, _center.y, this.domElement, this._tbRadius);\n              if (rayDir !== void 0) {\n                this._startCursorPosition.copy(rayDir);\n              }\n              this.activateGizmos(true);\n              if (this.enableAnimations) {\n                this._timePrev = this._timeCurrent = performance.now();\n                this._angleCurrent = this._anglePrev = 0;\n                this._cursorPosPrev.copy(this._startCursorPosition);\n                this._cursorPosCurr.copy(this._cursorPosPrev);\n                this._wCurr = 0;\n                this._wPrev = this._wCurr;\n              }\n            }\n            this.dispatchEvent(_changeEvent);\n            break;\n          case \"FOV\":\n            if (!this.enableZoom) return;\n            if (this.camera instanceof PerspectiveCamera) {\n              if (this._animationId != -1) {\n                cancelAnimationFrame(this._animationId);\n                this._animationId = -1;\n                this._timeStart = -1;\n                this.activateGizmos(false);\n                this.dispatchEvent(_changeEvent);\n              }\n              this.updateTbState(STATE.FOV, true);\n              this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n              this._currentCursorPosition.copy(this._startCursorPosition);\n            }\n            break;\n          case \"ZOOM\":\n            if (!this.enableZoom) return;\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n              this.activateGizmos(false);\n              this.dispatchEvent(_changeEvent);\n            }\n            this.updateTbState(STATE.SCALE, true);\n            this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n            this._currentCursorPosition.copy(this._startCursorPosition);\n            break;\n        }\n      }\n    });\n    __publicField(this, \"onSinglePanMove\", (event, opState) => {\n      if (this.enabled && this.domElement) {\n        const restart = opState != this._state;\n        this.setCenter(event.clientX, event.clientY);\n        switch (opState) {\n          case STATE.PAN:\n            if (this.enablePan && this.camera) {\n              if (restart) {\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n                if (rayDir !== void 0) {\n                  this._startCursorPosition.copy(rayDir);\n                }\n                if (this.enableGrid) {\n                  this.drawGrid();\n                }\n                this.activateGizmos(false);\n              } else {\n                const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n                if (rayDir !== void 0) {\n                  this._currentCursorPosition.copy(rayDir);\n                }\n                this.applyTransformMatrix(this.pan(this._startCursorPosition, this._currentCursorPosition));\n              }\n            }\n            break;\n          case STATE.ROTATE:\n            if (this.enableRotate && this.camera) {\n              if (restart) {\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                const rayDir = this.unprojectOnTbSurface(this.camera, _center.x, _center.y, this.domElement, this._tbRadius);\n                if (rayDir !== void 0) {\n                  this._startCursorPosition.copy(rayDir);\n                }\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n                this.activateGizmos(true);\n              } else {\n                const rayDir = this.unprojectOnTbSurface(this.camera, _center.x, _center.y, this.domElement, this._tbRadius);\n                if (rayDir !== void 0) {\n                  this._currentCursorPosition.copy(rayDir);\n                }\n                const distance = this._startCursorPosition.distanceTo(this._currentCursorPosition);\n                const angle = this._startCursorPosition.angleTo(this._currentCursorPosition);\n                const amount = Math.max(distance / this._tbRadius, angle);\n                this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition, this._currentCursorPosition), amount));\n                if (this.enableAnimations) {\n                  this._timePrev = this._timeCurrent;\n                  this._timeCurrent = performance.now();\n                  this._anglePrev = this._angleCurrent;\n                  this._angleCurrent = amount;\n                  this._cursorPosPrev.copy(this._cursorPosCurr);\n                  this._cursorPosCurr.copy(this._currentCursorPosition);\n                  this._wPrev = this._wCurr;\n                  this._wCurr = this.calculateAngularSpeed(this._anglePrev, this._angleCurrent, this._timePrev, this._timeCurrent);\n                }\n              }\n            }\n            break;\n          case STATE.SCALE:\n            if (this.enableZoom) {\n              if (restart) {\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n                this._currentCursorPosition.copy(this._startCursorPosition);\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n                this.activateGizmos(false);\n              } else {\n                const screenNotches = 8;\n                this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n                const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n                let size = 1;\n                if (movement < 0) {\n                  size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n                } else if (movement > 0) {\n                  size = Math.pow(this.scaleFactor, movement * screenNotches);\n                }\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n              }\n            }\n            break;\n          case STATE.FOV:\n            if (this.enableZoom && this.camera instanceof PerspectiveCamera) {\n              if (restart) {\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n                this._currentCursorPosition.copy(this._startCursorPosition);\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n                this.activateGizmos(false);\n              } else {\n                const screenNotches = 8;\n                this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n                const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n                let size = 1;\n                if (movement < 0) {\n                  size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n                } else if (movement > 0) {\n                  size = Math.pow(this.scaleFactor, movement * screenNotches);\n                }\n                this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n                const x = this._v3_1.distanceTo(this._gizmos.position);\n                let xNew = x / size;\n                xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n                const y = x * Math.tan(MathUtils.DEG2RAD * this._fovState * 0.5);\n                let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2);\n                newFov = MathUtils.clamp(newFov, this.minFov, this.maxFov);\n                const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                size = x / newDistance;\n                this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n                this.setFov(newFov);\n                this.applyTransformMatrix(this.applyScale(size, this._v3_2, false));\n                const direction = this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(newDistance / x);\n                this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n              }\n            }\n            break;\n        }\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onSinglePanEnd\", () => {\n      if (this._state == STATE.ROTATE) {\n        if (!this.enableRotate) {\n          return;\n        }\n        if (this.enableAnimations) {\n          const deltaTime = performance.now() - this._timeCurrent;\n          if (deltaTime < 120) {\n            const w = Math.abs((this._wPrev + this._wCurr) / 2);\n            const self = this;\n            this._animationId = window.requestAnimationFrame(function (t) {\n              self.updateTbState(STATE.ANIMATION_ROTATE, true);\n              const rotationAxis = self.calculateRotationAxis(self._cursorPosPrev, self._cursorPosCurr);\n              self.onRotationAnim(t, rotationAxis, Math.min(w, self.wMax));\n            });\n          } else {\n            this.updateTbState(STATE.IDLE, false);\n            this.activateGizmos(false);\n            this.dispatchEvent(_changeEvent);\n          }\n        } else {\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      } else if (this._state == STATE.PAN || this._state == STATE.IDLE) {\n        this.updateTbState(STATE.IDLE, false);\n        if (this.enableGrid) {\n          this.disposeGrid();\n        }\n        this.activateGizmos(false);\n        this.dispatchEvent(_changeEvent);\n      }\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onDoubleTap\", event => {\n      if (this.enabled && this.enablePan && this.scene && this.camera && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.setCenter(event.clientX, event.clientY);\n        const hitP = this.unprojectOnObj(this.getCursorNDC(_center.x, _center.y, this.domElement), this.camera);\n        if (hitP && this.enableAnimations) {\n          const self = this;\n          if (this._animationId != -1) {\n            window.cancelAnimationFrame(this._animationId);\n          }\n          this._timeStart = -1;\n          this._animationId = window.requestAnimationFrame(function (t) {\n            self.updateTbState(STATE.ANIMATION_FOCUS, true);\n            self.onFocusAnim(t, hitP, self._cameraMatrixState, self._gizmoMatrixState);\n          });\n        } else if (hitP && !this.enableAnimations) {\n          this.updateTbState(STATE.FOCUS, true);\n          this.focus(hitP, this.scaleFactor);\n          this.updateTbState(STATE.IDLE, false);\n          this.dispatchEvent(_changeEvent);\n        }\n      }\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onDoublePanStart\", () => {\n      if (this.enabled && this.enablePan && this.camera && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.PAN, true);\n        this.setCenter((this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2, (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2);\n        const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement, true);\n        if (rayDir !== void 0) {\n          this._startCursorPosition.copy(rayDir);\n        }\n        this._currentCursorPosition.copy(this._startCursorPosition);\n        this.activateGizmos(false);\n      }\n    });\n    __publicField(this, \"onDoublePanMove\", () => {\n      if (this.enabled && this.enablePan && this.camera && this.domElement) {\n        this.setCenter((this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2, (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2);\n        if (this._state != STATE.PAN) {\n          this.updateTbState(STATE.PAN, true);\n          this._startCursorPosition.copy(this._currentCursorPosition);\n        }\n        const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement, true);\n        if (rayDir !== void 0) this._currentCursorPosition.copy(rayDir);\n        this.applyTransformMatrix(this.pan(this._startCursorPosition, this._currentCursorPosition, true));\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onDoublePanEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onRotateStart\", () => {\n      var _a;\n      if (this.enabled && this.enableRotate) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.ZROTATE, true);\n        this._startFingerRotation = this.getAngle(this._touchCurrent[1], this._touchCurrent[0]) + this.getAngle(this._touchStart[1], this._touchStart[0]);\n        this._currentFingerRotation = this._startFingerRotation;\n        (_a = this.camera) == null ? void 0 : _a.getWorldDirection(this._rotationAxis);\n        if (!this.enablePan && !this.enableZoom) {\n          this.activateGizmos(true);\n        }\n      }\n    });\n    __publicField(this, \"onRotateMove\", () => {\n      var _a;\n      if (this.enabled && this.enableRotate && this.camera && this.domElement) {\n        this.setCenter((this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2, (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2);\n        let rotationPoint;\n        if (this._state != STATE.ZROTATE) {\n          this.updateTbState(STATE.ZROTATE, true);\n          this._startFingerRotation = this._currentFingerRotation;\n        }\n        this._currentFingerRotation = this.getAngle(this._touchCurrent[1], this._touchCurrent[0]) + this.getAngle(this._touchStart[1], this._touchStart[0]);\n        if (!this.enablePan) {\n          rotationPoint = new Vector3().setFromMatrixPosition(this._gizmoMatrixState);\n        } else if (this.camera) {\n          this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n          rotationPoint = (_a = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) == null ? void 0 : _a.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._v3_2);\n        }\n        const amount = MathUtils.DEG2RAD * (this._startFingerRotation - this._currentFingerRotation);\n        if (rotationPoint !== void 0) {\n          this.applyTransformMatrix(this.zRotate(rotationPoint, amount));\n        }\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onRotateEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.activateGizmos(false);\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onPinchStart\", () => {\n      if (this.enabled && this.enableZoom) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.SCALE, true);\n        this._startFingerDistance = this.calculatePointersDistance(this._touchCurrent[0], this._touchCurrent[1]);\n        this._currentFingerDistance = this._startFingerDistance;\n        this.activateGizmos(false);\n      }\n    });\n    __publicField(this, \"onPinchMove\", () => {\n      var _a, _b;\n      if (this.enabled && this.enableZoom && this.domElement) {\n        this.setCenter((this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2, (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2);\n        const minDistance = 12;\n        if (this._state != STATE.SCALE) {\n          this._startFingerDistance = this._currentFingerDistance;\n          this.updateTbState(STATE.SCALE, true);\n        }\n        this._currentFingerDistance = Math.max(this.calculatePointersDistance(this._touchCurrent[0], this._touchCurrent[1]), minDistance * this._devPxRatio);\n        const amount = this._currentFingerDistance / this._startFingerDistance;\n        let scalePoint;\n        if (!this.enablePan) {\n          scalePoint = this._gizmos.position;\n        } else {\n          if (this.camera instanceof OrthographicCamera) {\n            scalePoint = (_a = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) == null ? void 0 : _a.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._gizmos.position);\n          } else if (this.camera instanceof PerspectiveCamera) {\n            scalePoint = (_b = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) == null ? void 0 : _b.applyQuaternion(this.camera.quaternion).add(this._gizmos.position);\n          }\n        }\n        if (scalePoint !== void 0) {\n          this.applyTransformMatrix(this.applyScale(amount, scalePoint));\n        }\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onPinchEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onTriplePanStart\", () => {\n      if (this.enabled && this.enableZoom && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.SCALE, true);\n        let clientX = 0;\n        let clientY = 0;\n        const nFingers = this._touchCurrent.length;\n        for (let i = 0; i < nFingers; i++) {\n          clientX += this._touchCurrent[i].clientX;\n          clientY += this._touchCurrent[i].clientY;\n        }\n        this.setCenter(clientX / nFingers, clientY / nFingers);\n        this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n        this._currentCursorPosition.copy(this._startCursorPosition);\n      }\n    });\n    __publicField(this, \"onTriplePanMove\", () => {\n      if (this.enabled && this.enableZoom && this.camera && this.domElement) {\n        let clientX = 0;\n        let clientY = 0;\n        const nFingers = this._touchCurrent.length;\n        for (let i = 0; i < nFingers; i++) {\n          clientX += this._touchCurrent[i].clientX;\n          clientY += this._touchCurrent[i].clientY;\n        }\n        this.setCenter(clientX / nFingers, clientY / nFingers);\n        const screenNotches = 8;\n        this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n        const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n        let size = 1;\n        if (movement < 0) {\n          size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n        } else if (movement > 0) {\n          size = Math.pow(this.scaleFactor, movement * screenNotches);\n        }\n        this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n        const x = this._v3_1.distanceTo(this._gizmos.position);\n        let xNew = x / size;\n        xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n        const y = x * Math.tan(MathUtils.DEG2RAD * this._fovState * 0.5);\n        let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2);\n        newFov = MathUtils.clamp(newFov, this.minFov, this.maxFov);\n        const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n        size = x / newDistance;\n        this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n        this.setFov(newFov);\n        this.applyTransformMatrix(this.applyScale(size, this._v3_2, false));\n        const direction = this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(newDistance / x);\n        this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onTriplePanEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent);\n    });\n    /**\n     * Set _center's x/y coordinates\n     * @param {Number} clientX\n     * @param {Number} clientY\n     */\n    __publicField(this, \"setCenter\", (clientX, clientY) => {\n      _center.x = clientX;\n      _center.y = clientY;\n    });\n    /**\n     * Set default mouse actions\n     */\n    __publicField(this, \"initializeMouseActions\", () => {\n      this.setMouseAction(\"PAN\", 0, \"CTRL\");\n      this.setMouseAction(\"PAN\", 2);\n      this.setMouseAction(\"ROTATE\", 0);\n      this.setMouseAction(\"ZOOM\", \"WHEEL\");\n      this.setMouseAction(\"ZOOM\", 1);\n      this.setMouseAction(\"FOV\", \"WHEEL\", \"SHIFT\");\n      this.setMouseAction(\"FOV\", 1, \"SHIFT\");\n    });\n    /**\n     * Set a new mouse action by specifying the operation to be performed and a mouse/key combination. In case of conflict, replaces the existing one\n     * @param {String} operation The operation to be performed ('PAN', 'ROTATE', 'ZOOM', 'FOV)\n     * @param {*} mouse A mouse button (0, 1, 2) or 'WHEEL' for wheel notches\n     * @param {*} key The keyboard modifier ('CTRL', 'SHIFT') or null if key is not needed\n     * @returns {Boolean} True if the mouse action has been successfully added, false otherwise\n     */\n    __publicField(this, \"setMouseAction\", (operation, mouse, key = null) => {\n      const operationInput = [\"PAN\", \"ROTATE\", \"ZOOM\", \"FOV\"];\n      const mouseInput = [0, 1, 2, \"WHEEL\"];\n      const keyInput = [\"CTRL\", \"SHIFT\", null];\n      let state;\n      if (!operationInput.includes(operation) || !mouseInput.includes(mouse) || !keyInput.includes(key)) {\n        return false;\n      }\n      if (mouse == \"WHEEL\") {\n        if (operation != \"ZOOM\" && operation != \"FOV\") {\n          return false;\n        }\n      }\n      switch (operation) {\n        case \"PAN\":\n          state = STATE.PAN;\n          break;\n        case \"ROTATE\":\n          state = STATE.ROTATE;\n          break;\n        case \"ZOOM\":\n          state = STATE.SCALE;\n          break;\n        case \"FOV\":\n          state = STATE.FOV;\n          break;\n      }\n      const action = {\n        operation,\n        mouse,\n        key,\n        state\n      };\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        if (this.mouseActions[i].mouse == action.mouse && this.mouseActions[i].key == action.key) {\n          this.mouseActions.splice(i, 1, action);\n          return true;\n        }\n      }\n      this.mouseActions.push(action);\n      return true;\n    });\n    /**\n     * Return the operation associated to a mouse/keyboard combination\n     * @param {*} mouse A mouse button (0, 1, 2) or 'WHEEL' for wheel notches\n     * @param {*} key The keyboard modifier ('CTRL', 'SHIFT') or null if key is not needed\n     * @returns The operation if it has been found, null otherwise\n     */\n    __publicField(this, \"getOpFromAction\", (mouse, key) => {\n      let action;\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        action = this.mouseActions[i];\n        if (action.mouse == mouse && action.key == key) {\n          return action.operation;\n        }\n      }\n      if (key) {\n        for (let i = 0; i < this.mouseActions.length; i++) {\n          action = this.mouseActions[i];\n          if (action.mouse == mouse && action.key == null) {\n            return action.operation;\n          }\n        }\n      }\n      return null;\n    });\n    /**\n     * Get the operation associated to mouse and key combination and returns the corresponding FSA state\n     * @param {Number} mouse Mouse button\n     * @param {String} key Keyboard modifier\n     * @returns The FSA state obtained from the operation associated to mouse/keyboard combination\n     */\n    __publicField(this, \"getOpStateFromAction\", (mouse, key) => {\n      let action;\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        action = this.mouseActions[i];\n        if (action.mouse == mouse && action.key == key) {\n          return action.state;\n        }\n      }\n      if (key) {\n        for (let i = 0; i < this.mouseActions.length; i++) {\n          action = this.mouseActions[i];\n          if (action.mouse == mouse && action.key == null) {\n            return action.state;\n          }\n        }\n      }\n      return null;\n    });\n    /**\n     * Calculate the angle between two pointers\n     * @param {PointerEvent} p1\n     * @param {PointerEvent} p2\n     * @returns {Number} The angle between two pointers in degrees\n     */\n    __publicField(this, \"getAngle\", (p1, p2) => {\n      return Math.atan2(p2.clientY - p1.clientY, p2.clientX - p1.clientX) * 180 / Math.PI;\n    });\n    /**\n     * Update a PointerEvent inside current pointerevents array\n     * @param {PointerEvent} event\n     */\n    __publicField(this, \"updateTouchEvent\", event => {\n      for (let i = 0; i < this._touchCurrent.length; i++) {\n        if (this._touchCurrent[i].pointerId == event.pointerId) {\n          this._touchCurrent.splice(i, 1, event);\n          break;\n        }\n      }\n    });\n    /**\n     * Calculate the angular speed\n     * @param {Number} p0 Position at t0\n     * @param {Number} p1 Position at t1\n     * @param {Number} t0 Initial time in milliseconds\n     * @param {Number} t1 Ending time in milliseconds\n     */\n    __publicField(this, \"calculateAngularSpeed\", (p0, p1, t0, t1) => {\n      const s = p1 - p0;\n      const t = (t1 - t0) / 1e3;\n      if (t == 0) {\n        return 0;\n      }\n      return s / t;\n    });\n    /**\n     * Calculate the distance between two pointers\n     * @param {PointerEvent} p0 The first pointer\n     * @param {PointerEvent} p1 The second pointer\n     * @returns {number} The distance between the two pointers\n     */\n    __publicField(this, \"calculatePointersDistance\", (p0, p1) => {\n      return Math.sqrt(Math.pow(p1.clientX - p0.clientX, 2) + Math.pow(p1.clientY - p0.clientY, 2));\n    });\n    /**\n     * Calculate the rotation axis as the vector perpendicular between two vectors\n     * @param {Vector3} vec1 The first vector\n     * @param {Vector3} vec2 The second vector\n     * @returns {Vector3} The normalized rotation axis\n     */\n    __publicField(this, \"calculateRotationAxis\", (vec1, vec2) => {\n      this._rotationMatrix.extractRotation(this._cameraMatrixState);\n      this._quat.setFromRotationMatrix(this._rotationMatrix);\n      this._rotationAxis.crossVectors(vec1, vec2).applyQuaternion(this._quat);\n      return this._rotationAxis.normalize().clone();\n    });\n    /**\n     * Calculate the trackball radius so that gizmo's diamater will be 2/3 of the minimum side of the camera frustum\n     * @param {Camera} camera\n     * @returns {Number} The trackball radius\n     */\n    __publicField(this, \"calculateTbRadius\", camera => {\n      const factor = 0.67;\n      const distance = camera.position.distanceTo(this._gizmos.position);\n      if (camera instanceof PerspectiveCamera) {\n        const halfFovV = MathUtils.DEG2RAD * camera.fov * 0.5;\n        const halfFovH = Math.atan(camera.aspect * Math.tan(halfFovV));\n        return Math.tan(Math.min(halfFovV, halfFovH)) * distance * factor;\n      } else if (camera instanceof OrthographicCamera) {\n        return Math.min(camera.top, camera.right) * factor;\n      }\n    });\n    /**\n     * Focus operation consist of positioning the point of interest in front of the camera and a slightly zoom in\n     * @param {Vector3} point The point of interest\n     * @param {Number} size Scale factor\n     * @param {Number} amount Amount of operation to be completed (used for focus animations, default is complete full operation)\n     */\n    __publicField(this, \"focus\", (point, size, amount = 1) => {\n      if (this.camera) {\n        const focusPoint = point.clone();\n        focusPoint.sub(this._gizmos.position).multiplyScalar(amount);\n        this._translationMatrix.makeTranslation(focusPoint.x, focusPoint.y, focusPoint.z);\n        const gizmoStateTemp = this._gizmoMatrixState.clone();\n        this._gizmoMatrixState.premultiply(this._translationMatrix);\n        this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n        const cameraStateTemp = this._cameraMatrixState.clone();\n        this._cameraMatrixState.premultiply(this._translationMatrix);\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n        if (this.enableZoom) {\n          this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n        }\n        this._gizmoMatrixState.copy(gizmoStateTemp);\n        this._cameraMatrixState.copy(cameraStateTemp);\n      }\n    });\n    /**\n     * Draw a grid and add it to the scene\n     */\n    __publicField(this, \"drawGrid\", () => {\n      if (this.scene) {\n        const color = 8947848;\n        const multiplier = 3;\n        let size, divisions, maxLength, tick;\n        if (this.camera instanceof OrthographicCamera) {\n          const width = this.camera.right - this.camera.left;\n          const height = this.camera.bottom - this.camera.top;\n          maxLength = Math.max(width, height);\n          tick = maxLength / 20;\n          size = maxLength / this.camera.zoom * multiplier;\n          divisions = size / tick * this.camera.zoom;\n        } else if (this.camera instanceof PerspectiveCamera) {\n          const distance = this.camera.position.distanceTo(this._gizmos.position);\n          const halfFovV = MathUtils.DEG2RAD * this.camera.fov * 0.5;\n          const halfFovH = Math.atan(this.camera.aspect * Math.tan(halfFovV));\n          maxLength = Math.tan(Math.max(halfFovV, halfFovH)) * distance * 2;\n          tick = maxLength / 20;\n          size = maxLength * multiplier;\n          divisions = size / tick;\n        }\n        if (this._grid == null && this.camera) {\n          this._grid = new GridHelper(size, divisions, color, color);\n          this._grid.position.copy(this._gizmos.position);\n          this._gridPosition.copy(this._grid.position);\n          this._grid.quaternion.copy(this.camera.quaternion);\n          this._grid.rotateX(Math.PI * 0.5);\n          this.scene.add(this._grid);\n        }\n      }\n    });\n    __publicField(this, \"connect\", domElement => {\n      if (domElement === document) {\n        console.error('THREE.ArcballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.');\n      }\n      this.domElement = domElement;\n      this.domElement.style.touchAction = \"none\";\n      this.domElement.addEventListener(\"contextmenu\", this.onContextMenu);\n      this.domElement.addEventListener(\"pointerdown\", this.onPointerDown);\n      this.domElement.addEventListener(\"pointercancel\", this.onPointerCancel);\n      this.domElement.addEventListener(\"wheel\", this.onWheel);\n    });\n    /**\n     * Remove all listeners, stop animations and clean scene\n     */\n    __publicField(this, \"dispose\", () => {\n      var _a, _b, _c, _d, _e;\n      if (this._animationId != -1) {\n        window.cancelAnimationFrame(this._animationId);\n      }\n      (_a = this.domElement) == null ? void 0 : _a.removeEventListener(\"pointerdown\", this.onPointerDown);\n      (_b = this.domElement) == null ? void 0 : _b.removeEventListener(\"pointercancel\", this.onPointerCancel);\n      (_c = this.domElement) == null ? void 0 : _c.removeEventListener(\"wheel\", this.onWheel);\n      (_d = this.domElement) == null ? void 0 : _d.removeEventListener(\"contextmenu\", this.onContextMenu);\n      window.removeEventListener(\"pointermove\", this.onPointerMove);\n      window.removeEventListener(\"pointerup\", this.onPointerUp);\n      window.removeEventListener(\"resize\", this.onWindowResize);\n      (_e = this.scene) == null ? void 0 : _e.remove(this._gizmos);\n      this.disposeGrid();\n    });\n    /**\n     * remove the grid from the scene\n     */\n    __publicField(this, \"disposeGrid\", () => {\n      if (this._grid && this.scene) {\n        this.scene.remove(this._grid);\n        this._grid = null;\n      }\n    });\n    /**\n     * Compute the easing out cubic function for ease out effect in animation\n     * @param {Number} t The absolute progress of the animation in the bound of 0 (beginning of the) and 1 (ending of animation)\n     * @returns {Number} Result of easing out cubic at time t\n     */\n    __publicField(this, \"easeOutCubic\", t => {\n      return 1 - Math.pow(1 - t, 3);\n    });\n    /**\n     * Make rotation gizmos more or less visible\n     * @param {Boolean} isActive If true, make gizmos more visible\n     */\n    __publicField(this, \"activateGizmos\", isActive => {\n      for (const gizmo of this._gizmos.children) {\n        ;\n        gizmo.material.setValues({\n          opacity: isActive ? 1 : 0.6\n        });\n      }\n    });\n    /**\n     * Calculate the cursor position in NDC\n     * @param {number} x Cursor horizontal coordinate within the canvas\n     * @param {number} y Cursor vertical coordinate within the canvas\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @returns {Vector2} Cursor normalized position inside the canvas\n     */\n    __publicField(this, \"getCursorNDC\", (cursorX, cursorY, canvas) => {\n      const canvasRect = canvas.getBoundingClientRect();\n      this._v2_1.setX((cursorX - canvasRect.left) / canvasRect.width * 2 - 1);\n      this._v2_1.setY((canvasRect.bottom - cursorY) / canvasRect.height * 2 - 1);\n      return this._v2_1.clone();\n    });\n    /**\n     * Calculate the cursor position inside the canvas x/y coordinates with the origin being in the center of the canvas\n     * @param {Number} x Cursor horizontal coordinate within the canvas\n     * @param {Number} y Cursor vertical coordinate within the canvas\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @returns {Vector2} Cursor position inside the canvas\n     */\n    __publicField(this, \"getCursorPosition\", (cursorX, cursorY, canvas) => {\n      this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas));\n      if (this.camera instanceof OrthographicCamera) {\n        this._v2_1.x *= (this.camera.right - this.camera.left) * 0.5;\n        this._v2_1.y *= (this.camera.top - this.camera.bottom) * 0.5;\n      }\n      return this._v2_1.clone();\n    });\n    /**\n     * Set the camera to be controlled\n     * @param {Camera} camera The virtual camera to be controlled\n     */\n    __publicField(this, \"setCamera\", camera => {\n      if (camera) {\n        camera.lookAt(this.target);\n        camera.updateMatrix();\n        if (camera instanceof PerspectiveCamera) {\n          this._fov0 = camera.fov;\n          this._fovState = camera.fov;\n        }\n        this._cameraMatrixState0.copy(camera.matrix);\n        this._cameraMatrixState.copy(this._cameraMatrixState0);\n        this._cameraProjectionState.copy(camera.projectionMatrix);\n        this._zoom0 = camera.zoom;\n        this._zoomState = this._zoom0;\n        this._initialNear = camera.near;\n        this._nearPos0 = camera.position.distanceTo(this.target) - camera.near;\n        this._nearPos = this._initialNear;\n        this._initialFar = camera.far;\n        this._farPos0 = camera.position.distanceTo(this.target) - camera.far;\n        this._farPos = this._initialFar;\n        this._up0.copy(camera.up);\n        this._upState.copy(camera.up);\n        this.camera = camera;\n        this.camera.updateProjectionMatrix();\n        const tbRadius = this.calculateTbRadius(camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        this.makeGizmos(this.target, this._tbRadius);\n      }\n    });\n    /**\n     * Creates the rotation gizmos matching trackball center and radius\n     * @param {Vector3} tbCenter The trackball center\n     * @param {number} tbRadius The trackball radius\n     */\n    __publicField(this, \"makeGizmos\", (tbCenter, tbRadius) => {\n      const curve = new EllipseCurve(0, 0, tbRadius, tbRadius);\n      const points = curve.getPoints(this._curvePts);\n      const curveGeometry = new BufferGeometry().setFromPoints(points);\n      const curveMaterialX = new LineBasicMaterial({\n        color: 16744576,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      const curveMaterialY = new LineBasicMaterial({\n        color: 8454016,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      const curveMaterialZ = new LineBasicMaterial({\n        color: 8421631,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      const gizmoX = new Line(curveGeometry, curveMaterialX);\n      const gizmoY = new Line(curveGeometry, curveMaterialY);\n      const gizmoZ = new Line(curveGeometry, curveMaterialZ);\n      const rotation = Math.PI * 0.5;\n      gizmoX.rotation.x = rotation;\n      gizmoY.rotation.y = rotation;\n      this._gizmoMatrixState0.identity().setPosition(tbCenter);\n      this._gizmoMatrixState.copy(this._gizmoMatrixState0);\n      if (this.camera && this.camera.zoom != 1) {\n        const size = 1 / this.camera.zoom;\n        this._scaleMatrix.makeScale(size, size, size);\n        this._translationMatrix.makeTranslation(-tbCenter.x, -tbCenter.y, -tbCenter.z);\n        this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix);\n        this._translationMatrix.makeTranslation(tbCenter.x, tbCenter.y, tbCenter.z);\n        this._gizmoMatrixState.premultiply(this._translationMatrix);\n      }\n      this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n      this._gizmos.clear();\n      this._gizmos.add(gizmoX);\n      this._gizmos.add(gizmoY);\n      this._gizmos.add(gizmoZ);\n    });\n    /**\n     * Perform animation for focus operation\n     * @param {Number} time Instant in which this function is called as performance.now()\n     * @param {Vector3} point Point of interest for focus operation\n     * @param {Matrix4} cameraMatrix Camera matrix\n     * @param {Matrix4} gizmoMatrix Gizmos matrix\n     */\n    __publicField(this, \"onFocusAnim\", (time, point, cameraMatrix, gizmoMatrix) => {\n      if (this._timeStart == -1) {\n        this._timeStart = time;\n      }\n      if (this._state == STATE.ANIMATION_FOCUS) {\n        const deltaTime = time - this._timeStart;\n        const animTime = deltaTime / this.focusAnimationTime;\n        this._gizmoMatrixState.copy(gizmoMatrix);\n        if (animTime >= 1) {\n          this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n          this.focus(point, this.scaleFactor);\n          this._timeStart = -1;\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        } else {\n          const amount = this.easeOutCubic(animTime);\n          const size = 1 - amount + this.scaleFactor * amount;\n          this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n          this.focus(point, size, amount);\n          this.dispatchEvent(_changeEvent);\n          const self = this;\n          this._animationId = window.requestAnimationFrame(function (t) {\n            self.onFocusAnim(t, point, cameraMatrix, gizmoMatrix.clone());\n          });\n        }\n      } else {\n        this._animationId = -1;\n        this._timeStart = -1;\n      }\n    });\n    /**\n     * Perform animation for rotation operation\n     * @param {Number} time Instant in which this function is called as performance.now()\n     * @param {Vector3} rotationAxis Rotation axis\n     * @param {number} w0 Initial angular velocity\n     */\n    __publicField(this, \"onRotationAnim\", (time, rotationAxis, w0) => {\n      if (this._timeStart == -1) {\n        this._anglePrev = 0;\n        this._angleCurrent = 0;\n        this._timeStart = time;\n      }\n      if (this._state == STATE.ANIMATION_ROTATE) {\n        const deltaTime = (time - this._timeStart) / 1e3;\n        const w = w0 + -this.dampingFactor * deltaTime;\n        if (w > 0) {\n          this._angleCurrent = 0.5 * -this.dampingFactor * Math.pow(deltaTime, 2) + w0 * deltaTime + 0;\n          this.applyTransformMatrix(this.rotate(rotationAxis, this._angleCurrent));\n          this.dispatchEvent(_changeEvent);\n          const self = this;\n          this._animationId = window.requestAnimationFrame(function (t) {\n            self.onRotationAnim(t, rotationAxis, w0);\n          });\n        } else {\n          this._animationId = -1;\n          this._timeStart = -1;\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      } else {\n        this._animationId = -1;\n        this._timeStart = -1;\n        if (this._state != STATE.ROTATE) {\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      }\n    });\n    /**\n     * Perform pan operation moving camera between two points\n     * @param {Vector3} p0 Initial point\n     * @param {Vector3} p1 Ending point\n     * @param {Boolean} adjust If movement should be adjusted considering camera distance (Perspective only)\n     */\n    __publicField(this, \"pan\", (p0, p1, adjust = false) => {\n      if (this.camera) {\n        const movement = p0.clone().sub(p1);\n        if (this.camera instanceof OrthographicCamera) {\n          movement.multiplyScalar(1 / this.camera.zoom);\n        }\n        if (this.camera instanceof PerspectiveCamera && adjust) {\n          this._v3_1.setFromMatrixPosition(this._cameraMatrixState0);\n          this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);\n          const distanceFactor = this._v3_1.distanceTo(this._v3_2) / this.camera.position.distanceTo(this._gizmos.position);\n          movement.multiplyScalar(1 / distanceFactor);\n        }\n        this._v3_1.set(movement.x, movement.y, 0).applyQuaternion(this.camera.quaternion);\n        this._m4_1.makeTranslation(this._v3_1.x, this._v3_1.y, this._v3_1.z);\n        this.setTransformationMatrices(this._m4_1, this._m4_1);\n      }\n      return _transformation;\n    });\n    /**\n     * Reset trackball\n     */\n    __publicField(this, \"reset\", () => {\n      if (this.camera) {\n        this.camera.zoom = this._zoom0;\n        if (this.camera instanceof PerspectiveCamera) {\n          this.camera.fov = this._fov0;\n        }\n        this.camera.near = this._nearPos;\n        this.camera.far = this._farPos;\n        this._cameraMatrixState.copy(this._cameraMatrixState0);\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n        this.camera.up.copy(this._up0);\n        this.camera.updateMatrix();\n        this.camera.updateProjectionMatrix();\n        this._gizmoMatrixState.copy(this._gizmoMatrixState0);\n        this._gizmoMatrixState0.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n        this._gizmos.updateMatrix();\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        this.makeGizmos(this._gizmos.position, this._tbRadius);\n        this.camera.lookAt(this._gizmos.position);\n        this.updateTbState(STATE.IDLE, false);\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    /**\n     * Rotate the camera around an axis passing by trackball's center\n     * @param {Vector3} axis Rotation axis\n     * @param {number} angle Angle in radians\n     * @returns {Object} Object with 'camera' field containing transformation matrix resulting from the operation to be applied to the camera\n     */\n    __publicField(this, \"rotate\", (axis, angle) => {\n      const point = this._gizmos.position;\n      this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n      this._rotationMatrix.makeRotationAxis(axis, -angle);\n      this._m4_1.makeTranslation(point.x, point.y, point.z);\n      this._m4_1.multiply(this._rotationMatrix);\n      this._m4_1.multiply(this._translationMatrix);\n      this.setTransformationMatrices(this._m4_1);\n      return _transformation;\n    });\n    __publicField(this, \"copyState\", () => {\n      if (this.camera) {\n        const state = JSON.stringify(this.camera instanceof OrthographicCamera ? {\n          arcballState: {\n            cameraFar: this.camera.far,\n            cameraMatrix: this.camera.matrix,\n            cameraNear: this.camera.near,\n            cameraUp: this.camera.up,\n            cameraZoom: this.camera.zoom,\n            gizmoMatrix: this._gizmos.matrix\n          }\n        } : {\n          arcballState: {\n            cameraFar: this.camera.far,\n            cameraFov: this.camera.fov,\n            cameraMatrix: this.camera.matrix,\n            cameraNear: this.camera.near,\n            cameraUp: this.camera.up,\n            cameraZoom: this.camera.zoom,\n            gizmoMatrix: this._gizmos.matrix\n          }\n        });\n        navigator.clipboard.writeText(state);\n      }\n    });\n    __publicField(this, \"pasteState\", () => {\n      const self = this;\n      navigator.clipboard.readText().then(function resolved(value) {\n        self.setStateFromJSON(value);\n      });\n    });\n    /**\n     * Save the current state of the control. This can later be recovered with .reset\n     */\n    __publicField(this, \"saveState\", () => {\n      if (!this.camera) return;\n      this._cameraMatrixState0.copy(this.camera.matrix);\n      this._gizmoMatrixState0.copy(this._gizmos.matrix);\n      this._nearPos = this.camera.near;\n      this._farPos = this.camera.far;\n      this._zoom0 = this.camera.zoom;\n      this._up0.copy(this.camera.up);\n      if (this.camera instanceof PerspectiveCamera) {\n        this._fov0 = this.camera.fov;\n      }\n    });\n    /**\n     * Perform uniform scale operation around a given point\n     * @param {Number} size Scale factor\n     * @param {Vector3} point Point around which scale\n     * @param {Boolean} scaleGizmos If gizmos should be scaled (Perspective only)\n     * @returns {Object} Object with 'camera' and 'gizmo' fields containing transformation matrices resulting from the operation to be applied to the camera and gizmos\n     */\n    __publicField(this, \"applyScale\", (size, point, scaleGizmos = true) => {\n      if (!this.camera) return;\n      const scalePoint = point.clone();\n      let sizeInverse = 1 / size;\n      if (this.camera instanceof OrthographicCamera) {\n        this.camera.zoom = this._zoomState;\n        this.camera.zoom *= size;\n        if (this.camera.zoom > this.maxZoom) {\n          this.camera.zoom = this.maxZoom;\n          sizeInverse = this._zoomState / this.maxZoom;\n        } else if (this.camera.zoom < this.minZoom) {\n          this.camera.zoom = this.minZoom;\n          sizeInverse = this._zoomState / this.minZoom;\n        }\n        this.camera.updateProjectionMatrix();\n        this._v3_1.setFromMatrixPosition(this._gizmoMatrixState);\n        this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n        this._translationMatrix.makeTranslation(-this._v3_1.x, -this._v3_1.y, -this._v3_1.z);\n        this._m4_2.makeTranslation(this._v3_1.x, this._v3_1.y, this._v3_1.z).multiply(this._scaleMatrix);\n        this._m4_2.multiply(this._translationMatrix);\n        scalePoint.sub(this._v3_1);\n        const amount = scalePoint.clone().multiplyScalar(sizeInverse);\n        scalePoint.sub(amount);\n        this._m4_1.makeTranslation(scalePoint.x, scalePoint.y, scalePoint.z);\n        this._m4_2.premultiply(this._m4_1);\n        this.setTransformationMatrices(this._m4_1, this._m4_2);\n        return _transformation;\n      }\n      if (this.camera instanceof PerspectiveCamera) {\n        this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n        this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n        let distance = this._v3_1.distanceTo(scalePoint);\n        let amount = distance - distance * sizeInverse;\n        const newDistance = distance - amount;\n        if (newDistance < this.minDistance) {\n          sizeInverse = this.minDistance / distance;\n          amount = distance - distance * sizeInverse;\n        } else if (newDistance > this.maxDistance) {\n          sizeInverse = this.maxDistance / distance;\n          amount = distance - distance * sizeInverse;\n        }\n        let direction = scalePoint.clone().sub(this._v3_1).normalize().multiplyScalar(amount);\n        this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n        if (scaleGizmos) {\n          const pos = this._v3_2;\n          distance = pos.distanceTo(scalePoint);\n          amount = distance - distance * sizeInverse;\n          direction = scalePoint.clone().sub(this._v3_2).normalize().multiplyScalar(amount);\n          this._translationMatrix.makeTranslation(pos.x, pos.y, pos.z);\n          this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n          this._m4_2.makeTranslation(direction.x, direction.y, direction.z).multiply(this._translationMatrix);\n          this._m4_2.multiply(this._scaleMatrix);\n          this._translationMatrix.makeTranslation(-pos.x, -pos.y, -pos.z);\n          this._m4_2.multiply(this._translationMatrix);\n          this.setTransformationMatrices(this._m4_1, this._m4_2);\n        } else {\n          this.setTransformationMatrices(this._m4_1);\n        }\n        return _transformation;\n      }\n    });\n    /**\n     * Set camera fov\n     * @param {Number} value fov to be setted\n     */\n    __publicField(this, \"setFov\", value => {\n      if (this.camera instanceof PerspectiveCamera) {\n        this.camera.fov = MathUtils.clamp(value, this.minFov, this.maxFov);\n        this.camera.updateProjectionMatrix();\n      }\n    });\n    /**\n     * Set the trackball's center point\n     * @param {Number} x X coordinate\n     * @param {Number} y Y coordinate\n     * @param {Number} z Z coordinate\n     */\n    __publicField(this, \"setTarget\", (x, y, z) => {\n      if (this.camera) {\n        this.target.set(x, y, z);\n        this._gizmos.position.set(x, y, z);\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        this.makeGizmos(this.target, this._tbRadius);\n        this.camera.lookAt(this.target);\n      }\n    });\n    /**\n     * Rotate camera around its direction axis passing by a given point by a given angle\n     * @param {Vector3} point The point where the rotation axis is passing trough\n     * @param {Number} angle Angle in radians\n     * @returns The computed transormation matix\n     */\n    __publicField(this, \"zRotate\", (point, angle) => {\n      this._rotationMatrix.makeRotationAxis(this._rotationAxis, angle);\n      this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n      this._m4_1.makeTranslation(point.x, point.y, point.z);\n      this._m4_1.multiply(this._rotationMatrix);\n      this._m4_1.multiply(this._translationMatrix);\n      this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(point);\n      this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis, angle);\n      this._v3_2.sub(this._v3_1);\n      this._m4_2.makeTranslation(this._v3_2.x, this._v3_2.y, this._v3_2.z);\n      this.setTransformationMatrices(this._m4_1, this._m4_2);\n      return _transformation;\n    });\n    /**\n     * Unproject the cursor on the 3D object surface\n     * @param {Vector2} cursor Cursor coordinates in NDC\n     * @param {Camera} camera Virtual camera\n     * @returns {Vector3} The point of intersection with the model, if exist, null otherwise\n     */\n    __publicField(this, \"unprojectOnObj\", (cursor, camera) => {\n      if (!this.scene) return null;\n      const raycaster = new Raycaster();\n      raycaster.near = camera.near;\n      raycaster.far = camera.far;\n      raycaster.setFromCamera(cursor, camera);\n      const intersect = raycaster.intersectObjects(this.scene.children, true);\n      for (let i = 0; i < intersect.length; i++) {\n        if (intersect[i].object.uuid != this._gizmos.uuid && intersect[i].face) {\n          return intersect[i].point.clone();\n        }\n      }\n      return null;\n    });\n    /**\n     * Unproject the cursor on the trackball surface\n     * @param {Camera} camera The virtual camera\n     * @param {Number} cursorX Cursor horizontal coordinate on screen\n     * @param {Number} cursorY Cursor vertical coordinate on screen\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @param {number} tbRadius The trackball radius\n     * @returns {Vector3} The unprojected point on the trackball surface\n     */\n    __publicField(this, \"unprojectOnTbSurface\", (camera, cursorX, cursorY, canvas, tbRadius) => {\n      if (camera instanceof OrthographicCamera) {\n        this._v2_1.copy(this.getCursorPosition(cursorX, cursorY, canvas));\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, 0);\n        const x2 = Math.pow(this._v2_1.x, 2);\n        const y2 = Math.pow(this._v2_1.y, 2);\n        const r2 = Math.pow(this._tbRadius, 2);\n        if (x2 + y2 <= r2 * 0.5) {\n          this._v3_1.setZ(Math.sqrt(r2 - (x2 + y2)));\n        } else {\n          this._v3_1.setZ(r2 * 0.5 / Math.sqrt(x2 + y2));\n        }\n        return this._v3_1;\n      }\n      if (camera instanceof PerspectiveCamera) {\n        this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas));\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, -1);\n        this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n        const rayDir = this._v3_1.clone().normalize();\n        const cameraGizmoDistance = camera.position.distanceTo(this._gizmos.position);\n        const radius2 = Math.pow(tbRadius, 2);\n        const h = this._v3_1.z;\n        const l = Math.sqrt(Math.pow(this._v3_1.x, 2) + Math.pow(this._v3_1.y, 2));\n        if (l == 0) {\n          rayDir.set(this._v3_1.x, this._v3_1.y, tbRadius);\n          return rayDir;\n        }\n        const m = h / l;\n        const q = cameraGizmoDistance;\n        let a = Math.pow(m, 2) + 1;\n        let b = 2 * m * q;\n        let c = Math.pow(q, 2) - radius2;\n        let delta = Math.pow(b, 2) - 4 * a * c;\n        if (delta >= 0) {\n          this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n          this._v2_1.setY(m * this._v2_1.x + q);\n          const angle = MathUtils.RAD2DEG * this._v2_1.angle();\n          if (angle >= 45) {\n            const rayLength2 = Math.sqrt(Math.pow(this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - this._v2_1.y, 2));\n            rayDir.multiplyScalar(rayLength2);\n            rayDir.z += cameraGizmoDistance;\n            return rayDir;\n          }\n        }\n        a = m;\n        b = q;\n        c = -radius2 * 0.5;\n        delta = Math.pow(b, 2) - 4 * a * c;\n        this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n        this._v2_1.setY(m * this._v2_1.x + q);\n        const rayLength = Math.sqrt(Math.pow(this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - this._v2_1.y, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z += cameraGizmoDistance;\n        return rayDir;\n      }\n    });\n    /**\n     * Unproject the cursor on the plane passing through the center of the trackball orthogonal to the camera\n     * @param {Camera} camera The virtual camera\n     * @param {Number} cursorX Cursor horizontal coordinate on screen\n     * @param {Number} cursorY Cursor vertical coordinate on screen\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @param {Boolean} initialDistance If initial distance between camera and gizmos should be used for calculations instead of current (Perspective only)\n     * @returns {Vector3} The unprojected point on the trackball plane\n     */\n    __publicField(this, \"unprojectOnTbPlane\", (camera, cursorX, cursorY, canvas, initialDistance = false) => {\n      if (camera instanceof OrthographicCamera) {\n        this._v2_1.copy(this.getCursorPosition(cursorX, cursorY, canvas));\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, 0);\n        return this._v3_1.clone();\n      }\n      if (camera instanceof PerspectiveCamera) {\n        this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas));\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, -1);\n        this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n        const rayDir = this._v3_1.clone().normalize();\n        const h = this._v3_1.z;\n        const l = Math.sqrt(Math.pow(this._v3_1.x, 2) + Math.pow(this._v3_1.y, 2));\n        let cameraGizmoDistance;\n        if (initialDistance) {\n          cameraGizmoDistance = this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0));\n        } else {\n          cameraGizmoDistance = camera.position.distanceTo(this._gizmos.position);\n        }\n        if (l == 0) {\n          rayDir.set(0, 0, 0);\n          return rayDir;\n        }\n        const m = h / l;\n        const q = cameraGizmoDistance;\n        const x = -q / m;\n        const rayLength = Math.sqrt(Math.pow(q, 2) + Math.pow(x, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z = 0;\n        return rayDir;\n      }\n    });\n    /**\n     * Update camera and gizmos state\n     */\n    __publicField(this, \"updateMatrixState\", () => {\n      if (!this.camera) return;\n      this._cameraMatrixState.copy(this.camera.matrix);\n      this._gizmoMatrixState.copy(this._gizmos.matrix);\n      if (this.camera instanceof OrthographicCamera) {\n        this._cameraProjectionState.copy(this.camera.projectionMatrix);\n        this.camera.updateProjectionMatrix();\n        this._zoomState = this.camera.zoom;\n      }\n      if (this.camera instanceof PerspectiveCamera) {\n        this._fovState = this.camera.fov;\n      }\n    });\n    /**\n     * Update the trackball FSA\n     * @param {STATE} newState New state of the FSA\n     * @param {Boolean} updateMatrices If matriices state should be updated\n     */\n    __publicField(this, \"updateTbState\", (newState, updateMatrices) => {\n      this._state = newState;\n      if (updateMatrices) {\n        this.updateMatrixState();\n      }\n    });\n    __publicField(this, \"update\", () => {\n      const EPS = 1e-6;\n      if (!this.target.equals(this._currentTarget) && this.camera) {\n        this._gizmos.position.set(this.target.x, this.target.y, this.target.z);\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        this.makeGizmos(this.target, this._tbRadius);\n        this._currentTarget.copy(this.target);\n      }\n      if (!this.camera) return;\n      if (this.camera instanceof OrthographicCamera) {\n        if (this.camera.zoom > this.maxZoom || this.camera.zoom < this.minZoom) {\n          const newZoom = MathUtils.clamp(this.camera.zoom, this.minZoom, this.maxZoom);\n          this.applyTransformMatrix(this.applyScale(newZoom / this.camera.zoom, this._gizmos.position, true));\n        }\n      }\n      if (this.camera instanceof PerspectiveCamera) {\n        const distance = this.camera.position.distanceTo(this._gizmos.position);\n        if (distance > this.maxDistance + EPS || distance < this.minDistance - EPS) {\n          const newDistance = MathUtils.clamp(distance, this.minDistance, this.maxDistance);\n          this.applyTransformMatrix(this.applyScale(newDistance / distance, this._gizmos.position));\n          this.updateMatrixState();\n        }\n        if (this.camera.fov < this.minFov || this.camera.fov > this.maxFov) {\n          this.camera.fov = MathUtils.clamp(this.camera.fov, this.minFov, this.maxFov);\n          this.camera.updateProjectionMatrix();\n        }\n        const oldRadius = this._tbRadius;\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        if (oldRadius < this._tbRadius - EPS || oldRadius > this._tbRadius + EPS) {\n          const scale = (this._gizmos.scale.x + this._gizmos.scale.y + this._gizmos.scale.z) / 3;\n          const newRadius = this._tbRadius / scale;\n          const curve = new EllipseCurve(0, 0, newRadius, newRadius);\n          const points = curve.getPoints(this._curvePts);\n          const curveGeometry = new BufferGeometry().setFromPoints(points);\n          for (const gizmo in this._gizmos.children) {\n            const child = this._gizmos.children[gizmo];\n            child.geometry = curveGeometry;\n          }\n        }\n      }\n      this.camera.lookAt(this._gizmos.position);\n    });\n    __publicField(this, \"setStateFromJSON\", json => {\n      const state = JSON.parse(json);\n      if (state.arcballState && this.camera) {\n        this._cameraMatrixState.fromArray(state.arcballState.cameraMatrix.elements);\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n        this.camera.up.copy(state.arcballState.cameraUp);\n        this.camera.near = state.arcballState.cameraNear;\n        this.camera.far = state.arcballState.cameraFar;\n        this.camera.zoom = state.arcballState.cameraZoom;\n        if (this.camera instanceof PerspectiveCamera) {\n          this.camera.fov = state.arcballState.cameraFov;\n        }\n        this._gizmoMatrixState.fromArray(state.arcballState.gizmoMatrix.elements);\n        this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n        this.camera.updateMatrix();\n        this.camera.updateProjectionMatrix();\n        this._gizmos.updateMatrix();\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        const gizmoTmp = new Matrix4().copy(this._gizmoMatrixState0);\n        this.makeGizmos(this._gizmos.position, this._tbRadius);\n        this._gizmoMatrixState0.copy(gizmoTmp);\n        this.camera.lookAt(this._gizmos.position);\n        this.updateTbState(STATE.IDLE, false);\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    this.camera = null;\n    this.domElement = domElement;\n    this.scene = scene;\n    this.mouseActions = [];\n    this._mouseOp = null;\n    this._v2_1 = new Vector2();\n    this._v3_1 = new Vector3();\n    this._v3_2 = new Vector3();\n    this._m4_1 = new Matrix4();\n    this._m4_2 = new Matrix4();\n    this._quat = new Quaternion();\n    this._translationMatrix = new Matrix4();\n    this._rotationMatrix = new Matrix4();\n    this._scaleMatrix = new Matrix4();\n    this._rotationAxis = new Vector3();\n    this._cameraMatrixState = new Matrix4();\n    this._cameraProjectionState = new Matrix4();\n    this._fovState = 1;\n    this._upState = new Vector3();\n    this._zoomState = 1;\n    this._nearPos = 0;\n    this._farPos = 0;\n    this._gizmoMatrixState = new Matrix4();\n    this._up0 = new Vector3();\n    this._zoom0 = 1;\n    this._fov0 = 0;\n    this._initialNear = 0;\n    this._nearPos0 = 0;\n    this._initialFar = 0;\n    this._farPos0 = 0;\n    this._cameraMatrixState0 = new Matrix4();\n    this._gizmoMatrixState0 = new Matrix4();\n    this._button = -1;\n    this._touchStart = [];\n    this._touchCurrent = [];\n    this._input = INPUT.NONE;\n    this._switchSensibility = 32;\n    this._startFingerDistance = 0;\n    this._currentFingerDistance = 0;\n    this._startFingerRotation = 0;\n    this._currentFingerRotation = 0;\n    this._devPxRatio = 0;\n    this._downValid = true;\n    this._nclicks = 0;\n    this._downEvents = [];\n    this._clickStart = 0;\n    this._maxDownTime = 250;\n    this._maxInterval = 300;\n    this._posThreshold = 24;\n    this._movementThreshold = 24;\n    this._currentCursorPosition = new Vector3();\n    this._startCursorPosition = new Vector3();\n    this._grid = null;\n    this._gridPosition = new Vector3();\n    this._gizmos = new Group();\n    this._curvePts = 128;\n    this._timeStart = -1;\n    this._animationId = -1;\n    this.focusAnimationTime = 500;\n    this._timePrev = 0;\n    this._timeCurrent = 0;\n    this._anglePrev = 0;\n    this._angleCurrent = 0;\n    this._cursorPosPrev = new Vector3();\n    this._cursorPosCurr = new Vector3();\n    this._wPrev = 0;\n    this._wCurr = 0;\n    this.adjustNearFar = false;\n    this.scaleFactor = 1.1;\n    this.dampingFactor = 25;\n    this.wMax = 20;\n    this.enableAnimations = true;\n    this.enableGrid = false;\n    this.cursorZoom = false;\n    this.minFov = 5;\n    this.maxFov = 90;\n    this.enabled = true;\n    this.enablePan = true;\n    this.enableRotate = true;\n    this.enableZoom = true;\n    this.minDistance = 0;\n    this.maxDistance = Infinity;\n    this.minZoom = 0;\n    this.maxZoom = Infinity;\n    this.target = new Vector3(0, 0, 0);\n    this._currentTarget = new Vector3(0, 0, 0);\n    this._tbRadius = 1;\n    this._state = STATE.IDLE;\n    this.setCamera(camera);\n    if (this.scene) {\n      this.scene.add(this._gizmos);\n    }\n    this._devPxRatio = window.devicePixelRatio;\n    this.initializeMouseActions();\n    if (this.domElement) this.connect(this.domElement);\n    window.addEventListener(\"resize\", this.onWindowResize);\n  }\n  /**\n   * Apply a transformation matrix, to the camera and gizmos\n   * @param {Object} transformation Object containing matrices to apply to camera and gizmos\n   */\n  applyTransformMatrix(transformation) {\n    if ((transformation == null ? void 0 : transformation.camera) && this.camera) {\n      this._m4_1.copy(this._cameraMatrixState).premultiply(transformation.camera);\n      this._m4_1.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n      this.camera.updateMatrix();\n      if (this._state == STATE.ROTATE || this._state == STATE.ZROTATE || this._state == STATE.ANIMATION_ROTATE) {\n        this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion);\n      }\n    }\n    if (transformation == null ? void 0 : transformation.gizmos) {\n      this._m4_1.copy(this._gizmoMatrixState).premultiply(transformation.gizmos);\n      this._m4_1.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n      this._gizmos.updateMatrix();\n    }\n    if ((this._state == STATE.SCALE || this._state == STATE.FOCUS || this._state == STATE.ANIMATION_FOCUS) && this.camera) {\n      const tbRadius = this.calculateTbRadius(this.camera);\n      if (tbRadius !== void 0) {\n        this._tbRadius = tbRadius;\n      }\n      if (this.adjustNearFar) {\n        const cameraDistance = this.camera.position.distanceTo(this._gizmos.position);\n        const bb = new Box3();\n        bb.setFromObject(this._gizmos);\n        const sphere = new Sphere();\n        bb.getBoundingSphere(sphere);\n        const adjustedNearPosition = Math.max(this._nearPos0, sphere.radius + sphere.center.length());\n        const regularNearPosition = cameraDistance - this._initialNear;\n        const minNearPos = Math.min(adjustedNearPosition, regularNearPosition);\n        this.camera.near = cameraDistance - minNearPos;\n        const adjustedFarPosition = Math.min(this._farPos0, -sphere.radius + sphere.center.length());\n        const regularFarPosition = cameraDistance - this._initialFar;\n        const minFarPos = Math.min(adjustedFarPosition, regularFarPosition);\n        this.camera.far = cameraDistance - minFarPos;\n        this.camera.updateProjectionMatrix();\n      } else {\n        let update = false;\n        if (this.camera.near != this._initialNear) {\n          this.camera.near = this._initialNear;\n          update = true;\n        }\n        if (this.camera.far != this._initialFar) {\n          this.camera.far = this._initialFar;\n          update = true;\n        }\n        if (update) {\n          this.camera.updateProjectionMatrix();\n        }\n      }\n    }\n  }\n  /**\n   * Set gizmos visibility\n   * @param {Boolean} value Value of gizmos visibility\n   */\n  setGizmosVisible(value) {\n    this._gizmos.visible = value;\n    this.dispatchEvent(_changeEvent);\n  }\n  /**\n   * Set values in transformation object\n   * @param {Matrix4} camera Transformation to be applied to the camera\n   * @param {Matrix4} gizmos Transformation to be applied to gizmos\n   */\n  setTransformationMatrices(camera = null, gizmos = null) {\n    if (camera) {\n      if (_transformation.camera) {\n        _transformation.camera.copy(camera);\n      } else {\n        _transformation.camera = camera.clone();\n      }\n    } else {\n      _transformation.camera = null;\n    }\n    if (gizmos) {\n      if (_transformation.gizmos) {\n        _transformation.gizmos.copy(gizmos);\n      } else {\n        _transformation.gizmos = gizmos.clone();\n      }\n    } else {\n      _transformation.gizmos = null;\n    }\n  }\n}\nexport { ArcballControls };","map":{"version":3,"names":["__defProp","Object","defineProperty","__defNormalProp","obj","key","value","enumerable","configurable","writable","__publicField","Matrix4","EventDispatcher","Vector2","Vector3","Quaternion","Group","EllipseCurve","BufferGeometry","PerspectiveCamera","MathUtils","OrthographicCamera","Box3","Sphere","GridHelper","LineBasicMaterial","Line","Raycaster","STATE","IDLE","Symbol","ROTATE","PAN","SCALE","FOV","FOCUS","ZROTATE","TOUCH_MULTI","ANIMATION_FOCUS","ANIMATION_ROTATE","INPUT","NONE","ONE_FINGER","ONE_FINGER_SWITCHED","TWO_FINGER","MULT_FINGER","CURSOR","_center","x","y","_transformation","camera","gizmos","_changeEvent","type","_startEvent","_endEvent","ArcballControls","constructor","domElement","scene","scale","_gizmos","z","tbRadius","calculateTbRadius","_tbRadius","newRadius","curve","points","getPoints","_curvePts","curveGeometry","setFromPoints","gizmo","children","child","geometry","dispatchEvent","event","enabled","i","mouseActions","length","mouse","preventDefault","_touchStart","splice","_touchCurrent","_input","button","isPrimary","_downValid","_downEvents","push","pointerType","onSinglePanStart","window","addEventListener","onPointerMove","onPointerUp","onRotateStart","onPinchStart","onDoublePanStart","onTriplePanStart","modifier","ctrlKey","metaKey","shiftKey","_mouseOp","getOpFromAction","_button","updateTouchEvent","onSinglePanMove","movement","calculatePointersDistance","_devPxRatio","_switchSensibility","onRotateMove","onPinchMove","onDoublePanMove","onTriplePanMove","mouseOpState","getOpStateFromAction","_movementThreshold","nTouch","pointerId","removeEventListener","onSinglePanEnd","onDoublePanEnd","onPinchEnd","onRotateEnd","onTriplePanEnd","downTime","timeStamp","_maxDownTime","_nclicks","_clickStart","performance","now","clickInterval","_maxInterval","_posThreshold","onDoubleTap","shift","_a","_b","enableZoom","mouseOp","notchDeltaY","sgn","deltaY","size","scaleFactor","updateTbState","Math","pow","cursorZoom","enablePan","scalePoint","unprojectOnTbPlane","clientX","clientY","applyQuaternion","quaternion","multiplyScalar","zoom","add","position","applyTransformMatrix","applyScale","_grid","disposeGrid","drawGrid","deltaX","_v3_1","setFromMatrixPosition","_cameraMatrixState","distanceTo","xNew","clamp","minDistance","maxDistance","tan","DEG2RAD","fov","newFov","RAD2DEG","atan","maxFov","minFov","newDistance","setFov","operation","setCenter","_animationId","cancelAnimationFrame","_timeStart","activateGizmos","rayDir","_startCursorPosition","copy","enableGrid","enableRotate","unprojectOnTbSurface","enableAnimations","_timePrev","_timeCurrent","_angleCurrent","_anglePrev","_cursorPosPrev","_cursorPosCurr","_wCurr","_wPrev","setY","getCursorNDC","_currentCursorPosition","opState","restart","_state","pan","distance","angle","angleTo","amount","max","rotate","calculateRotationAxis","calculateAngularSpeed","screenNotches","_fovState","_v3_2","_gizmoMatrixState","direction","clone","sub","normalize","_m4_1","makeTranslation","deltaTime","w","abs","self","requestAnimationFrame","t","rotationAxis","onRotationAnim","min","wMax","hitP","unprojectOnObj","onFocusAnim","focus","_startFingerRotation","getAngle","_currentFingerRotation","getWorldDirection","_rotationAxis","rotationPoint","zRotate","_startFingerDistance","_currentFingerDistance","nFingers","setMouseAction","operationInput","mouseInput","keyInput","state","includes","action","p1","p2","atan2","PI","p0","t0","t1","s","sqrt","vec1","vec2","_rotationMatrix","extractRotation","_quat","setFromRotationMatrix","crossVectors","factor","halfFovV","halfFovH","aspect","top","right","point","focusPoint","_translationMatrix","gizmoStateTemp","premultiply","decompose","cameraStateTemp","color","multiplier","divisions","maxLength","tick","width","left","height","bottom","_gridPosition","rotateX","document","console","error","style","touchAction","onContextMenu","onPointerDown","onPointerCancel","onWheel","_c","_d","_e","onWindowResize","remove","isActive","material","setValues","opacity","cursorX","cursorY","canvas","canvasRect","getBoundingClientRect","_v2_1","setX","lookAt","target","updateMatrix","_fov0","_cameraMatrixState0","matrix","_cameraProjectionState","projectionMatrix","_zoom0","_zoomState","_initialNear","near","_nearPos0","_nearPos","_initialFar","far","_farPos0","_farPos","_up0","up","_upState","updateProjectionMatrix","makeGizmos","tbCenter","curveMaterialX","fog","transparent","curveMaterialY","curveMaterialZ","gizmoX","gizmoY","gizmoZ","rotation","_gizmoMatrixState0","identity","setPosition","_scaleMatrix","makeScale","clear","time","cameraMatrix","gizmoMatrix","animTime","focusAnimationTime","easeOutCubic","w0","dampingFactor","adjust","distanceFactor","set","setTransformationMatrices","axis","makeRotationAxis","multiply","JSON","stringify","arcballState","cameraFar","cameraNear","cameraUp","cameraZoom","cameraFov","navigator","clipboard","writeText","readText","then","resolved","setStateFromJSON","scaleGizmos","sizeInverse","maxZoom","minZoom","_m4_2","pos","applyAxisAngle","cursor","raycaster","setFromCamera","intersect","intersectObjects","object","uuid","face","getCursorPosition","x2","y2","r2","setZ","applyMatrix4","projectionMatrixInverse","cameraGizmoDistance","radius2","h","l","m","q","a","b","c","delta","rayLength2","rayLength","initialDistance","newState","updateMatrices","updateMatrixState","EPS","equals","_currentTarget","newZoom","oldRadius","json","parse","fromArray","elements","gizmoTmp","adjustNearFar","Infinity","setCamera","devicePixelRatio","initializeMouseActions","connect","transformation","cameraDistance","bb","setFromObject","sphere","getBoundingSphere","adjustedNearPosition","radius","center","regularNearPosition","minNearPos","adjustedFarPosition","regularFarPosition","minFarPos","update","setGizmosVisible","visible"],"sources":["/Users/rohullahkarimi/Local/laatuLakki_main/client/node_modules/three-stdlib/controls/ArcballControls.js"],"sourcesContent":["var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __publicField = (obj, key, value) => {\n  __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n  return value;\n};\nimport { Matrix4, EventDispatcher, Vector2, Vector3, Quaternion, Group, EllipseCurve, BufferGeometry, PerspectiveCamera, MathUtils, OrthographicCamera, Box3, Sphere, GridHelper, LineBasicMaterial, Line, Raycaster } from \"three\";\nconst STATE = {\n  IDLE: Symbol(),\n  ROTATE: Symbol(),\n  PAN: Symbol(),\n  SCALE: Symbol(),\n  FOV: Symbol(),\n  FOCUS: Symbol(),\n  ZROTATE: Symbol(),\n  TOUCH_MULTI: Symbol(),\n  ANIMATION_FOCUS: Symbol(),\n  ANIMATION_ROTATE: Symbol()\n};\nconst INPUT = {\n  NONE: Symbol(),\n  ONE_FINGER: Symbol(),\n  ONE_FINGER_SWITCHED: Symbol(),\n  TWO_FINGER: Symbol(),\n  MULT_FINGER: Symbol(),\n  CURSOR: Symbol()\n};\nconst _center = {\n  x: 0,\n  y: 0\n};\nconst _transformation = {\n  camera: /* @__PURE__ */ new Matrix4(),\n  gizmos: /* @__PURE__ */ new Matrix4()\n};\nconst _changeEvent = { type: \"change\" };\nconst _startEvent = { type: \"start\" };\nconst _endEvent = { type: \"end\" };\nclass ArcballControls extends EventDispatcher {\n  constructor(camera, domElement = null, scene = null) {\n    super();\n    __publicField(this, \"camera\");\n    __publicField(this, \"domElement\");\n    __publicField(this, \"scene\");\n    __publicField(this, \"mouseActions\");\n    __publicField(this, \"_mouseOp\");\n    __publicField(this, \"_v2_1\");\n    __publicField(this, \"_v3_1\");\n    __publicField(this, \"_v3_2\");\n    __publicField(this, \"_m4_1\");\n    __publicField(this, \"_m4_2\");\n    __publicField(this, \"_quat\");\n    __publicField(this, \"_translationMatrix\");\n    __publicField(this, \"_rotationMatrix\");\n    __publicField(this, \"_scaleMatrix\");\n    __publicField(this, \"_rotationAxis\");\n    __publicField(this, \"_cameraMatrixState\");\n    __publicField(this, \"_cameraProjectionState\");\n    __publicField(this, \"_fovState\");\n    __publicField(this, \"_upState\");\n    __publicField(this, \"_zoomState\");\n    __publicField(this, \"_nearPos\");\n    __publicField(this, \"_farPos\");\n    __publicField(this, \"_gizmoMatrixState\");\n    __publicField(this, \"_up0\");\n    __publicField(this, \"_zoom0\");\n    __publicField(this, \"_fov0\");\n    __publicField(this, \"_initialNear\");\n    __publicField(this, \"_nearPos0\");\n    __publicField(this, \"_initialFar\");\n    __publicField(this, \"_farPos0\");\n    __publicField(this, \"_cameraMatrixState0\");\n    __publicField(this, \"_gizmoMatrixState0\");\n    __publicField(this, \"_button\");\n    __publicField(this, \"_touchStart\");\n    __publicField(this, \"_touchCurrent\");\n    __publicField(this, \"_input\");\n    __publicField(this, \"_switchSensibility\");\n    __publicField(this, \"_startFingerDistance\");\n    __publicField(this, \"_currentFingerDistance\");\n    __publicField(this, \"_startFingerRotation\");\n    __publicField(this, \"_currentFingerRotation\");\n    __publicField(this, \"_devPxRatio\");\n    __publicField(this, \"_downValid\");\n    __publicField(this, \"_nclicks\");\n    __publicField(this, \"_downEvents\");\n    __publicField(this, \"_clickStart\");\n    __publicField(this, \"_maxDownTime\");\n    __publicField(this, \"_maxInterval\");\n    __publicField(this, \"_posThreshold\");\n    __publicField(this, \"_movementThreshold\");\n    __publicField(this, \"_currentCursorPosition\");\n    __publicField(this, \"_startCursorPosition\");\n    __publicField(this, \"_grid\");\n    __publicField(this, \"_gridPosition\");\n    __publicField(this, \"_gizmos\");\n    __publicField(this, \"_curvePts\");\n    __publicField(this, \"_timeStart\");\n    __publicField(this, \"_animationId\");\n    __publicField(this, \"focusAnimationTime\");\n    __publicField(this, \"_timePrev\");\n    __publicField(this, \"_timeCurrent\");\n    __publicField(this, \"_anglePrev\");\n    __publicField(this, \"_angleCurrent\");\n    __publicField(this, \"_cursorPosPrev\");\n    __publicField(this, \"_cursorPosCurr\");\n    __publicField(this, \"_wPrev\");\n    __publicField(this, \"_wCurr\");\n    __publicField(this, \"adjustNearFar\");\n    __publicField(this, \"scaleFactor\");\n    __publicField(this, \"dampingFactor\");\n    __publicField(this, \"wMax\");\n    __publicField(this, \"enableAnimations\");\n    __publicField(this, \"enableGrid\");\n    __publicField(this, \"cursorZoom\");\n    __publicField(this, \"minFov\");\n    __publicField(this, \"maxFov\");\n    __publicField(this, \"enabled\");\n    __publicField(this, \"enablePan\");\n    __publicField(this, \"enableRotate\");\n    __publicField(this, \"enableZoom\");\n    __publicField(this, \"minDistance\");\n    __publicField(this, \"maxDistance\");\n    __publicField(this, \"minZoom\");\n    __publicField(this, \"maxZoom\");\n    __publicField(this, \"target\");\n    __publicField(this, \"_currentTarget\");\n    __publicField(this, \"_tbRadius\");\n    __publicField(this, \"_state\");\n    //listeners\n    __publicField(this, \"onWindowResize\", () => {\n      const scale = (this._gizmos.scale.x + this._gizmos.scale.y + this._gizmos.scale.z) / 3;\n      if (this.camera) {\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n      }\n      const newRadius = this._tbRadius / scale;\n      const curve = new EllipseCurve(0, 0, newRadius, newRadius);\n      const points = curve.getPoints(this._curvePts);\n      const curveGeometry = new BufferGeometry().setFromPoints(points);\n      for (const gizmo in this._gizmos.children) {\n        const child = this._gizmos.children[gizmo];\n        child.geometry = curveGeometry;\n      }\n      this.dispatchEvent(_changeEvent);\n    });\n    __publicField(this, \"onContextMenu\", (event) => {\n      if (!this.enabled) {\n        return;\n      }\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        if (this.mouseActions[i].mouse == 2) {\n          event.preventDefault();\n          break;\n        }\n      }\n    });\n    __publicField(this, \"onPointerCancel\", () => {\n      this._touchStart.splice(0, this._touchStart.length);\n      this._touchCurrent.splice(0, this._touchCurrent.length);\n      this._input = INPUT.NONE;\n    });\n    __publicField(this, \"onPointerDown\", (event) => {\n      if (event.button == 0 && event.isPrimary) {\n        this._downValid = true;\n        this._downEvents.push(event);\n      } else {\n        this._downValid = false;\n      }\n      if (event.pointerType == \"touch\" && this._input != INPUT.CURSOR) {\n        this._touchStart.push(event);\n        this._touchCurrent.push(event);\n        switch (this._input) {\n          case INPUT.NONE:\n            this._input = INPUT.ONE_FINGER;\n            this.onSinglePanStart(event, \"ROTATE\");\n            window.addEventListener(\"pointermove\", this.onPointerMove);\n            window.addEventListener(\"pointerup\", this.onPointerUp);\n            break;\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            this._input = INPUT.TWO_FINGER;\n            this.onRotateStart();\n            this.onPinchStart();\n            this.onDoublePanStart();\n            break;\n          case INPUT.TWO_FINGER:\n            this._input = INPUT.MULT_FINGER;\n            this.onTriplePanStart();\n            break;\n        }\n      } else if (event.pointerType != \"touch\" && this._input == INPUT.NONE) {\n        let modifier = null;\n        if (event.ctrlKey || event.metaKey) {\n          modifier = \"CTRL\";\n        } else if (event.shiftKey) {\n          modifier = \"SHIFT\";\n        }\n        this._mouseOp = this.getOpFromAction(event.button, modifier);\n        if (this._mouseOp) {\n          window.addEventListener(\"pointermove\", this.onPointerMove);\n          window.addEventListener(\"pointerup\", this.onPointerUp);\n          this._input = INPUT.CURSOR;\n          this._button = event.button;\n          this.onSinglePanStart(event, this._mouseOp);\n        }\n      }\n    });\n    __publicField(this, \"onPointerMove\", (event) => {\n      if (event.pointerType == \"touch\" && this._input != INPUT.CURSOR) {\n        switch (this._input) {\n          case INPUT.ONE_FINGER:\n            this.updateTouchEvent(event);\n            this.onSinglePanMove(event, STATE.ROTATE);\n            break;\n          case INPUT.ONE_FINGER_SWITCHED:\n            const movement = this.calculatePointersDistance(this._touchCurrent[0], event) * this._devPxRatio;\n            if (movement >= this._switchSensibility) {\n              this._input = INPUT.ONE_FINGER;\n              this.updateTouchEvent(event);\n              this.onSinglePanStart(event, \"ROTATE\");\n              break;\n            }\n            break;\n          case INPUT.TWO_FINGER:\n            this.updateTouchEvent(event);\n            this.onRotateMove();\n            this.onPinchMove();\n            this.onDoublePanMove();\n            break;\n          case INPUT.MULT_FINGER:\n            this.updateTouchEvent(event);\n            this.onTriplePanMove();\n            break;\n        }\n      } else if (event.pointerType != \"touch\" && this._input == INPUT.CURSOR) {\n        let modifier = null;\n        if (event.ctrlKey || event.metaKey) {\n          modifier = \"CTRL\";\n        } else if (event.shiftKey) {\n          modifier = \"SHIFT\";\n        }\n        const mouseOpState = this.getOpStateFromAction(this._button, modifier);\n        if (mouseOpState) {\n          this.onSinglePanMove(event, mouseOpState);\n        }\n      }\n      if (this._downValid) {\n        const movement = this.calculatePointersDistance(this._downEvents[this._downEvents.length - 1], event) * this._devPxRatio;\n        if (movement > this._movementThreshold) {\n          this._downValid = false;\n        }\n      }\n    });\n    __publicField(this, \"onPointerUp\", (event) => {\n      if (event.pointerType == \"touch\" && this._input != INPUT.CURSOR) {\n        const nTouch = this._touchCurrent.length;\n        for (let i = 0; i < nTouch; i++) {\n          if (this._touchCurrent[i].pointerId == event.pointerId) {\n            this._touchCurrent.splice(i, 1);\n            this._touchStart.splice(i, 1);\n            break;\n          }\n        }\n        switch (this._input) {\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            window.removeEventListener(\"pointermove\", this.onPointerMove);\n            window.removeEventListener(\"pointerup\", this.onPointerUp);\n            this._input = INPUT.NONE;\n            this.onSinglePanEnd();\n            break;\n          case INPUT.TWO_FINGER:\n            this.onDoublePanEnd();\n            this.onPinchEnd();\n            this.onRotateEnd();\n            this._input = INPUT.ONE_FINGER_SWITCHED;\n            break;\n          case INPUT.MULT_FINGER:\n            if (this._touchCurrent.length == 0) {\n              window.removeEventListener(\"pointermove\", this.onPointerMove);\n              window.removeEventListener(\"pointerup\", this.onPointerUp);\n              this._input = INPUT.NONE;\n              this.onTriplePanEnd();\n            }\n            break;\n        }\n      } else if (event.pointerType != \"touch\" && this._input == INPUT.CURSOR) {\n        window.removeEventListener(\"pointermove\", this.onPointerMove);\n        window.removeEventListener(\"pointerup\", this.onPointerUp);\n        this._input = INPUT.NONE;\n        this.onSinglePanEnd();\n        this._button = -1;\n      }\n      if (event.isPrimary) {\n        if (this._downValid) {\n          const downTime = event.timeStamp - this._downEvents[this._downEvents.length - 1].timeStamp;\n          if (downTime <= this._maxDownTime) {\n            if (this._nclicks == 0) {\n              this._nclicks = 1;\n              this._clickStart = performance.now();\n            } else {\n              const clickInterval = event.timeStamp - this._clickStart;\n              const movement = this.calculatePointersDistance(this._downEvents[1], this._downEvents[0]) * this._devPxRatio;\n              if (clickInterval <= this._maxInterval && movement <= this._posThreshold) {\n                this._nclicks = 0;\n                this._downEvents.splice(0, this._downEvents.length);\n                this.onDoubleTap(event);\n              } else {\n                this._nclicks = 1;\n                this._downEvents.shift();\n                this._clickStart = performance.now();\n              }\n            }\n          } else {\n            this._downValid = false;\n            this._nclicks = 0;\n            this._downEvents.splice(0, this._downEvents.length);\n          }\n        } else {\n          this._nclicks = 0;\n          this._downEvents.splice(0, this._downEvents.length);\n        }\n      }\n    });\n    __publicField(this, \"onWheel\", (event) => {\n      var _a, _b;\n      if (this.enabled && this.enableZoom && this.domElement) {\n        let modifier = null;\n        if (event.ctrlKey || event.metaKey) {\n          modifier = \"CTRL\";\n        } else if (event.shiftKey) {\n          modifier = \"SHIFT\";\n        }\n        const mouseOp = this.getOpFromAction(\"WHEEL\", modifier);\n        if (mouseOp) {\n          event.preventDefault();\n          this.dispatchEvent(_startEvent);\n          const notchDeltaY = 125;\n          let sgn = event.deltaY / notchDeltaY;\n          let size = 1;\n          if (sgn > 0) {\n            size = 1 / this.scaleFactor;\n          } else if (sgn < 0) {\n            size = this.scaleFactor;\n          }\n          switch (mouseOp) {\n            case \"ZOOM\":\n              this.updateTbState(STATE.SCALE, true);\n              if (sgn > 0) {\n                size = 1 / Math.pow(this.scaleFactor, sgn);\n              } else if (sgn < 0) {\n                size = Math.pow(this.scaleFactor, -sgn);\n              }\n              if (this.cursorZoom && this.enablePan) {\n                let scalePoint;\n                if (this.camera instanceof OrthographicCamera) {\n                  scalePoint = (_a = this.unprojectOnTbPlane(this.camera, event.clientX, event.clientY, this.domElement)) == null ? void 0 : _a.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._gizmos.position);\n                }\n                if (this.camera instanceof PerspectiveCamera) {\n                  scalePoint = (_b = this.unprojectOnTbPlane(this.camera, event.clientX, event.clientY, this.domElement)) == null ? void 0 : _b.applyQuaternion(this.camera.quaternion).add(this._gizmos.position);\n                }\n                if (scalePoint !== void 0)\n                  this.applyTransformMatrix(this.applyScale(size, scalePoint));\n              } else {\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n              }\n              if (this._grid) {\n                this.disposeGrid();\n                this.drawGrid();\n              }\n              this.updateTbState(STATE.IDLE, false);\n              this.dispatchEvent(_changeEvent);\n              this.dispatchEvent(_endEvent);\n              break;\n            case \"FOV\":\n              if (this.camera instanceof PerspectiveCamera) {\n                this.updateTbState(STATE.FOV, true);\n                if (event.deltaX != 0) {\n                  sgn = event.deltaX / notchDeltaY;\n                  size = 1;\n                  if (sgn > 0) {\n                    size = 1 / Math.pow(this.scaleFactor, sgn);\n                  } else if (sgn < 0) {\n                    size = Math.pow(this.scaleFactor, -sgn);\n                  }\n                }\n                this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n                const x = this._v3_1.distanceTo(this._gizmos.position);\n                let xNew = x / size;\n                xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n                const y = x * Math.tan(MathUtils.DEG2RAD * this.camera.fov * 0.5);\n                let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2);\n                if (newFov > this.maxFov) {\n                  newFov = this.maxFov;\n                } else if (newFov < this.minFov) {\n                  newFov = this.minFov;\n                }\n                const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                size = x / newDistance;\n                this.setFov(newFov);\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position, false));\n              }\n              if (this._grid) {\n                this.disposeGrid();\n                this.drawGrid();\n              }\n              this.updateTbState(STATE.IDLE, false);\n              this.dispatchEvent(_changeEvent);\n              this.dispatchEvent(_endEvent);\n              break;\n          }\n        }\n      }\n    });\n    __publicField(this, \"onSinglePanStart\", (event, operation) => {\n      if (this.enabled && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.setCenter(event.clientX, event.clientY);\n        switch (operation) {\n          case \"PAN\":\n            if (!this.enablePan)\n              return;\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n              this.activateGizmos(false);\n              this.dispatchEvent(_changeEvent);\n            }\n            if (this.camera) {\n              this.updateTbState(STATE.PAN, true);\n              const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n              if (rayDir !== void 0) {\n                this._startCursorPosition.copy(rayDir);\n              }\n              if (this.enableGrid) {\n                this.drawGrid();\n                this.dispatchEvent(_changeEvent);\n              }\n            }\n            break;\n          case \"ROTATE\":\n            if (!this.enableRotate)\n              return;\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n            }\n            if (this.camera) {\n              this.updateTbState(STATE.ROTATE, true);\n              const rayDir = this.unprojectOnTbSurface(this.camera, _center.x, _center.y, this.domElement, this._tbRadius);\n              if (rayDir !== void 0) {\n                this._startCursorPosition.copy(rayDir);\n              }\n              this.activateGizmos(true);\n              if (this.enableAnimations) {\n                this._timePrev = this._timeCurrent = performance.now();\n                this._angleCurrent = this._anglePrev = 0;\n                this._cursorPosPrev.copy(this._startCursorPosition);\n                this._cursorPosCurr.copy(this._cursorPosPrev);\n                this._wCurr = 0;\n                this._wPrev = this._wCurr;\n              }\n            }\n            this.dispatchEvent(_changeEvent);\n            break;\n          case \"FOV\":\n            if (!this.enableZoom)\n              return;\n            if (this.camera instanceof PerspectiveCamera) {\n              if (this._animationId != -1) {\n                cancelAnimationFrame(this._animationId);\n                this._animationId = -1;\n                this._timeStart = -1;\n                this.activateGizmos(false);\n                this.dispatchEvent(_changeEvent);\n              }\n              this.updateTbState(STATE.FOV, true);\n              this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n              this._currentCursorPosition.copy(this._startCursorPosition);\n            }\n            break;\n          case \"ZOOM\":\n            if (!this.enableZoom)\n              return;\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n              this.activateGizmos(false);\n              this.dispatchEvent(_changeEvent);\n            }\n            this.updateTbState(STATE.SCALE, true);\n            this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n            this._currentCursorPosition.copy(this._startCursorPosition);\n            break;\n        }\n      }\n    });\n    __publicField(this, \"onSinglePanMove\", (event, opState) => {\n      if (this.enabled && this.domElement) {\n        const restart = opState != this._state;\n        this.setCenter(event.clientX, event.clientY);\n        switch (opState) {\n          case STATE.PAN:\n            if (this.enablePan && this.camera) {\n              if (restart) {\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n                if (rayDir !== void 0) {\n                  this._startCursorPosition.copy(rayDir);\n                }\n                if (this.enableGrid) {\n                  this.drawGrid();\n                }\n                this.activateGizmos(false);\n              } else {\n                const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n                if (rayDir !== void 0) {\n                  this._currentCursorPosition.copy(rayDir);\n                }\n                this.applyTransformMatrix(this.pan(this._startCursorPosition, this._currentCursorPosition));\n              }\n            }\n            break;\n          case STATE.ROTATE:\n            if (this.enableRotate && this.camera) {\n              if (restart) {\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                const rayDir = this.unprojectOnTbSurface(\n                  this.camera,\n                  _center.x,\n                  _center.y,\n                  this.domElement,\n                  this._tbRadius\n                );\n                if (rayDir !== void 0) {\n                  this._startCursorPosition.copy(rayDir);\n                }\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n                this.activateGizmos(true);\n              } else {\n                const rayDir = this.unprojectOnTbSurface(\n                  this.camera,\n                  _center.x,\n                  _center.y,\n                  this.domElement,\n                  this._tbRadius\n                );\n                if (rayDir !== void 0) {\n                  this._currentCursorPosition.copy(rayDir);\n                }\n                const distance = this._startCursorPosition.distanceTo(this._currentCursorPosition);\n                const angle = this._startCursorPosition.angleTo(this._currentCursorPosition);\n                const amount = Math.max(distance / this._tbRadius, angle);\n                this.applyTransformMatrix(\n                  this.rotate(this.calculateRotationAxis(this._startCursorPosition, this._currentCursorPosition), amount)\n                );\n                if (this.enableAnimations) {\n                  this._timePrev = this._timeCurrent;\n                  this._timeCurrent = performance.now();\n                  this._anglePrev = this._angleCurrent;\n                  this._angleCurrent = amount;\n                  this._cursorPosPrev.copy(this._cursorPosCurr);\n                  this._cursorPosCurr.copy(this._currentCursorPosition);\n                  this._wPrev = this._wCurr;\n                  this._wCurr = this.calculateAngularSpeed(\n                    this._anglePrev,\n                    this._angleCurrent,\n                    this._timePrev,\n                    this._timeCurrent\n                  );\n                }\n              }\n            }\n            break;\n          case STATE.SCALE:\n            if (this.enableZoom) {\n              if (restart) {\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n                this._currentCursorPosition.copy(this._startCursorPosition);\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n                this.activateGizmos(false);\n              } else {\n                const screenNotches = 8;\n                this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n                const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n                let size = 1;\n                if (movement < 0) {\n                  size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n                } else if (movement > 0) {\n                  size = Math.pow(this.scaleFactor, movement * screenNotches);\n                }\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n              }\n            }\n            break;\n          case STATE.FOV:\n            if (this.enableZoom && this.camera instanceof PerspectiveCamera) {\n              if (restart) {\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n                this._currentCursorPosition.copy(this._startCursorPosition);\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n                this.activateGizmos(false);\n              } else {\n                const screenNotches = 8;\n                this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n                const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n                let size = 1;\n                if (movement < 0) {\n                  size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n                } else if (movement > 0) {\n                  size = Math.pow(this.scaleFactor, movement * screenNotches);\n                }\n                this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n                const x = this._v3_1.distanceTo(this._gizmos.position);\n                let xNew = x / size;\n                xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n                const y = x * Math.tan(MathUtils.DEG2RAD * this._fovState * 0.5);\n                let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2);\n                newFov = MathUtils.clamp(newFov, this.minFov, this.maxFov);\n                const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                size = x / newDistance;\n                this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n                this.setFov(newFov);\n                this.applyTransformMatrix(this.applyScale(size, this._v3_2, false));\n                const direction = this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(newDistance / x);\n                this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n              }\n            }\n            break;\n        }\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onSinglePanEnd\", () => {\n      if (this._state == STATE.ROTATE) {\n        if (!this.enableRotate) {\n          return;\n        }\n        if (this.enableAnimations) {\n          const deltaTime = performance.now() - this._timeCurrent;\n          if (deltaTime < 120) {\n            const w = Math.abs((this._wPrev + this._wCurr) / 2);\n            const self = this;\n            this._animationId = window.requestAnimationFrame(function(t) {\n              self.updateTbState(STATE.ANIMATION_ROTATE, true);\n              const rotationAxis = self.calculateRotationAxis(self._cursorPosPrev, self._cursorPosCurr);\n              self.onRotationAnim(t, rotationAxis, Math.min(w, self.wMax));\n            });\n          } else {\n            this.updateTbState(STATE.IDLE, false);\n            this.activateGizmos(false);\n            this.dispatchEvent(_changeEvent);\n          }\n        } else {\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      } else if (this._state == STATE.PAN || this._state == STATE.IDLE) {\n        this.updateTbState(STATE.IDLE, false);\n        if (this.enableGrid) {\n          this.disposeGrid();\n        }\n        this.activateGizmos(false);\n        this.dispatchEvent(_changeEvent);\n      }\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onDoubleTap\", (event) => {\n      if (this.enabled && this.enablePan && this.scene && this.camera && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.setCenter(event.clientX, event.clientY);\n        const hitP = this.unprojectOnObj(this.getCursorNDC(_center.x, _center.y, this.domElement), this.camera);\n        if (hitP && this.enableAnimations) {\n          const self = this;\n          if (this._animationId != -1) {\n            window.cancelAnimationFrame(this._animationId);\n          }\n          this._timeStart = -1;\n          this._animationId = window.requestAnimationFrame(function(t) {\n            self.updateTbState(STATE.ANIMATION_FOCUS, true);\n            self.onFocusAnim(t, hitP, self._cameraMatrixState, self._gizmoMatrixState);\n          });\n        } else if (hitP && !this.enableAnimations) {\n          this.updateTbState(STATE.FOCUS, true);\n          this.focus(hitP, this.scaleFactor);\n          this.updateTbState(STATE.IDLE, false);\n          this.dispatchEvent(_changeEvent);\n        }\n      }\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onDoublePanStart\", () => {\n      if (this.enabled && this.enablePan && this.camera && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.PAN, true);\n        this.setCenter(\n          (this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2,\n          (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2\n        );\n        const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement, true);\n        if (rayDir !== void 0) {\n          this._startCursorPosition.copy(rayDir);\n        }\n        this._currentCursorPosition.copy(this._startCursorPosition);\n        this.activateGizmos(false);\n      }\n    });\n    __publicField(this, \"onDoublePanMove\", () => {\n      if (this.enabled && this.enablePan && this.camera && this.domElement) {\n        this.setCenter(\n          (this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2,\n          (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2\n        );\n        if (this._state != STATE.PAN) {\n          this.updateTbState(STATE.PAN, true);\n          this._startCursorPosition.copy(this._currentCursorPosition);\n        }\n        const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement, true);\n        if (rayDir !== void 0)\n          this._currentCursorPosition.copy(rayDir);\n        this.applyTransformMatrix(this.pan(this._startCursorPosition, this._currentCursorPosition, true));\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onDoublePanEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onRotateStart\", () => {\n      var _a;\n      if (this.enabled && this.enableRotate) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.ZROTATE, true);\n        this._startFingerRotation = this.getAngle(this._touchCurrent[1], this._touchCurrent[0]) + this.getAngle(this._touchStart[1], this._touchStart[0]);\n        this._currentFingerRotation = this._startFingerRotation;\n        (_a = this.camera) == null ? void 0 : _a.getWorldDirection(this._rotationAxis);\n        if (!this.enablePan && !this.enableZoom) {\n          this.activateGizmos(true);\n        }\n      }\n    });\n    __publicField(this, \"onRotateMove\", () => {\n      var _a;\n      if (this.enabled && this.enableRotate && this.camera && this.domElement) {\n        this.setCenter(\n          (this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2,\n          (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2\n        );\n        let rotationPoint;\n        if (this._state != STATE.ZROTATE) {\n          this.updateTbState(STATE.ZROTATE, true);\n          this._startFingerRotation = this._currentFingerRotation;\n        }\n        this._currentFingerRotation = this.getAngle(this._touchCurrent[1], this._touchCurrent[0]) + this.getAngle(this._touchStart[1], this._touchStart[0]);\n        if (!this.enablePan) {\n          rotationPoint = new Vector3().setFromMatrixPosition(this._gizmoMatrixState);\n        } else if (this.camera) {\n          this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n          rotationPoint = (_a = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) == null ? void 0 : _a.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._v3_2);\n        }\n        const amount = MathUtils.DEG2RAD * (this._startFingerRotation - this._currentFingerRotation);\n        if (rotationPoint !== void 0) {\n          this.applyTransformMatrix(this.zRotate(rotationPoint, amount));\n        }\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onRotateEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.activateGizmos(false);\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onPinchStart\", () => {\n      if (this.enabled && this.enableZoom) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.SCALE, true);\n        this._startFingerDistance = this.calculatePointersDistance(this._touchCurrent[0], this._touchCurrent[1]);\n        this._currentFingerDistance = this._startFingerDistance;\n        this.activateGizmos(false);\n      }\n    });\n    __publicField(this, \"onPinchMove\", () => {\n      var _a, _b;\n      if (this.enabled && this.enableZoom && this.domElement) {\n        this.setCenter(\n          (this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2,\n          (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2\n        );\n        const minDistance = 12;\n        if (this._state != STATE.SCALE) {\n          this._startFingerDistance = this._currentFingerDistance;\n          this.updateTbState(STATE.SCALE, true);\n        }\n        this._currentFingerDistance = Math.max(\n          this.calculatePointersDistance(this._touchCurrent[0], this._touchCurrent[1]),\n          minDistance * this._devPxRatio\n        );\n        const amount = this._currentFingerDistance / this._startFingerDistance;\n        let scalePoint;\n        if (!this.enablePan) {\n          scalePoint = this._gizmos.position;\n        } else {\n          if (this.camera instanceof OrthographicCamera) {\n            scalePoint = (_a = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) == null ? void 0 : _a.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._gizmos.position);\n          } else if (this.camera instanceof PerspectiveCamera) {\n            scalePoint = (_b = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) == null ? void 0 : _b.applyQuaternion(this.camera.quaternion).add(this._gizmos.position);\n          }\n        }\n        if (scalePoint !== void 0) {\n          this.applyTransformMatrix(this.applyScale(amount, scalePoint));\n        }\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onPinchEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onTriplePanStart\", () => {\n      if (this.enabled && this.enableZoom && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.SCALE, true);\n        let clientX = 0;\n        let clientY = 0;\n        const nFingers = this._touchCurrent.length;\n        for (let i = 0; i < nFingers; i++) {\n          clientX += this._touchCurrent[i].clientX;\n          clientY += this._touchCurrent[i].clientY;\n        }\n        this.setCenter(clientX / nFingers, clientY / nFingers);\n        this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n        this._currentCursorPosition.copy(this._startCursorPosition);\n      }\n    });\n    __publicField(this, \"onTriplePanMove\", () => {\n      if (this.enabled && this.enableZoom && this.camera && this.domElement) {\n        let clientX = 0;\n        let clientY = 0;\n        const nFingers = this._touchCurrent.length;\n        for (let i = 0; i < nFingers; i++) {\n          clientX += this._touchCurrent[i].clientX;\n          clientY += this._touchCurrent[i].clientY;\n        }\n        this.setCenter(clientX / nFingers, clientY / nFingers);\n        const screenNotches = 8;\n        this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n        const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n        let size = 1;\n        if (movement < 0) {\n          size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n        } else if (movement > 0) {\n          size = Math.pow(this.scaleFactor, movement * screenNotches);\n        }\n        this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n        const x = this._v3_1.distanceTo(this._gizmos.position);\n        let xNew = x / size;\n        xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n        const y = x * Math.tan(MathUtils.DEG2RAD * this._fovState * 0.5);\n        let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2);\n        newFov = MathUtils.clamp(newFov, this.minFov, this.maxFov);\n        const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n        size = x / newDistance;\n        this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n        this.setFov(newFov);\n        this.applyTransformMatrix(this.applyScale(size, this._v3_2, false));\n        const direction = this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(newDistance / x);\n        this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onTriplePanEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent);\n    });\n    /**\n     * Set _center's x/y coordinates\n     * @param {Number} clientX\n     * @param {Number} clientY\n     */\n    __publicField(this, \"setCenter\", (clientX, clientY) => {\n      _center.x = clientX;\n      _center.y = clientY;\n    });\n    /**\n     * Set default mouse actions\n     */\n    __publicField(this, \"initializeMouseActions\", () => {\n      this.setMouseAction(\"PAN\", 0, \"CTRL\");\n      this.setMouseAction(\"PAN\", 2);\n      this.setMouseAction(\"ROTATE\", 0);\n      this.setMouseAction(\"ZOOM\", \"WHEEL\");\n      this.setMouseAction(\"ZOOM\", 1);\n      this.setMouseAction(\"FOV\", \"WHEEL\", \"SHIFT\");\n      this.setMouseAction(\"FOV\", 1, \"SHIFT\");\n    });\n    /**\n     * Set a new mouse action by specifying the operation to be performed and a mouse/key combination. In case of conflict, replaces the existing one\n     * @param {String} operation The operation to be performed ('PAN', 'ROTATE', 'ZOOM', 'FOV)\n     * @param {*} mouse A mouse button (0, 1, 2) or 'WHEEL' for wheel notches\n     * @param {*} key The keyboard modifier ('CTRL', 'SHIFT') or null if key is not needed\n     * @returns {Boolean} True if the mouse action has been successfully added, false otherwise\n     */\n    __publicField(this, \"setMouseAction\", (operation, mouse, key = null) => {\n      const operationInput = [\"PAN\", \"ROTATE\", \"ZOOM\", \"FOV\"];\n      const mouseInput = [0, 1, 2, \"WHEEL\"];\n      const keyInput = [\"CTRL\", \"SHIFT\", null];\n      let state;\n      if (!operationInput.includes(operation) || !mouseInput.includes(mouse) || !keyInput.includes(key)) {\n        return false;\n      }\n      if (mouse == \"WHEEL\") {\n        if (operation != \"ZOOM\" && operation != \"FOV\") {\n          return false;\n        }\n      }\n      switch (operation) {\n        case \"PAN\":\n          state = STATE.PAN;\n          break;\n        case \"ROTATE\":\n          state = STATE.ROTATE;\n          break;\n        case \"ZOOM\":\n          state = STATE.SCALE;\n          break;\n        case \"FOV\":\n          state = STATE.FOV;\n          break;\n      }\n      const action = {\n        operation,\n        mouse,\n        key,\n        state\n      };\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        if (this.mouseActions[i].mouse == action.mouse && this.mouseActions[i].key == action.key) {\n          this.mouseActions.splice(i, 1, action);\n          return true;\n        }\n      }\n      this.mouseActions.push(action);\n      return true;\n    });\n    /**\n     * Return the operation associated to a mouse/keyboard combination\n     * @param {*} mouse A mouse button (0, 1, 2) or 'WHEEL' for wheel notches\n     * @param {*} key The keyboard modifier ('CTRL', 'SHIFT') or null if key is not needed\n     * @returns The operation if it has been found, null otherwise\n     */\n    __publicField(this, \"getOpFromAction\", (mouse, key) => {\n      let action;\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        action = this.mouseActions[i];\n        if (action.mouse == mouse && action.key == key) {\n          return action.operation;\n        }\n      }\n      if (key) {\n        for (let i = 0; i < this.mouseActions.length; i++) {\n          action = this.mouseActions[i];\n          if (action.mouse == mouse && action.key == null) {\n            return action.operation;\n          }\n        }\n      }\n      return null;\n    });\n    /**\n     * Get the operation associated to mouse and key combination and returns the corresponding FSA state\n     * @param {Number} mouse Mouse button\n     * @param {String} key Keyboard modifier\n     * @returns The FSA state obtained from the operation associated to mouse/keyboard combination\n     */\n    __publicField(this, \"getOpStateFromAction\", (mouse, key) => {\n      let action;\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        action = this.mouseActions[i];\n        if (action.mouse == mouse && action.key == key) {\n          return action.state;\n        }\n      }\n      if (key) {\n        for (let i = 0; i < this.mouseActions.length; i++) {\n          action = this.mouseActions[i];\n          if (action.mouse == mouse && action.key == null) {\n            return action.state;\n          }\n        }\n      }\n      return null;\n    });\n    /**\n     * Calculate the angle between two pointers\n     * @param {PointerEvent} p1\n     * @param {PointerEvent} p2\n     * @returns {Number} The angle between two pointers in degrees\n     */\n    __publicField(this, \"getAngle\", (p1, p2) => {\n      return Math.atan2(p2.clientY - p1.clientY, p2.clientX - p1.clientX) * 180 / Math.PI;\n    });\n    /**\n     * Update a PointerEvent inside current pointerevents array\n     * @param {PointerEvent} event\n     */\n    __publicField(this, \"updateTouchEvent\", (event) => {\n      for (let i = 0; i < this._touchCurrent.length; i++) {\n        if (this._touchCurrent[i].pointerId == event.pointerId) {\n          this._touchCurrent.splice(i, 1, event);\n          break;\n        }\n      }\n    });\n    /**\n     * Calculate the angular speed\n     * @param {Number} p0 Position at t0\n     * @param {Number} p1 Position at t1\n     * @param {Number} t0 Initial time in milliseconds\n     * @param {Number} t1 Ending time in milliseconds\n     */\n    __publicField(this, \"calculateAngularSpeed\", (p0, p1, t0, t1) => {\n      const s = p1 - p0;\n      const t = (t1 - t0) / 1e3;\n      if (t == 0) {\n        return 0;\n      }\n      return s / t;\n    });\n    /**\n     * Calculate the distance between two pointers\n     * @param {PointerEvent} p0 The first pointer\n     * @param {PointerEvent} p1 The second pointer\n     * @returns {number} The distance between the two pointers\n     */\n    __publicField(this, \"calculatePointersDistance\", (p0, p1) => {\n      return Math.sqrt(Math.pow(p1.clientX - p0.clientX, 2) + Math.pow(p1.clientY - p0.clientY, 2));\n    });\n    /**\n     * Calculate the rotation axis as the vector perpendicular between two vectors\n     * @param {Vector3} vec1 The first vector\n     * @param {Vector3} vec2 The second vector\n     * @returns {Vector3} The normalized rotation axis\n     */\n    __publicField(this, \"calculateRotationAxis\", (vec1, vec2) => {\n      this._rotationMatrix.extractRotation(this._cameraMatrixState);\n      this._quat.setFromRotationMatrix(this._rotationMatrix);\n      this._rotationAxis.crossVectors(vec1, vec2).applyQuaternion(this._quat);\n      return this._rotationAxis.normalize().clone();\n    });\n    /**\n     * Calculate the trackball radius so that gizmo's diamater will be 2/3 of the minimum side of the camera frustum\n     * @param {Camera} camera\n     * @returns {Number} The trackball radius\n     */\n    __publicField(this, \"calculateTbRadius\", (camera) => {\n      const factor = 0.67;\n      const distance = camera.position.distanceTo(this._gizmos.position);\n      if (camera instanceof PerspectiveCamera) {\n        const halfFovV = MathUtils.DEG2RAD * camera.fov * 0.5;\n        const halfFovH = Math.atan(camera.aspect * Math.tan(halfFovV));\n        return Math.tan(Math.min(halfFovV, halfFovH)) * distance * factor;\n      } else if (camera instanceof OrthographicCamera) {\n        return Math.min(camera.top, camera.right) * factor;\n      }\n    });\n    /**\n     * Focus operation consist of positioning the point of interest in front of the camera and a slightly zoom in\n     * @param {Vector3} point The point of interest\n     * @param {Number} size Scale factor\n     * @param {Number} amount Amount of operation to be completed (used for focus animations, default is complete full operation)\n     */\n    __publicField(this, \"focus\", (point, size, amount = 1) => {\n      if (this.camera) {\n        const focusPoint = point.clone();\n        focusPoint.sub(this._gizmos.position).multiplyScalar(amount);\n        this._translationMatrix.makeTranslation(focusPoint.x, focusPoint.y, focusPoint.z);\n        const gizmoStateTemp = this._gizmoMatrixState.clone();\n        this._gizmoMatrixState.premultiply(this._translationMatrix);\n        this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n        const cameraStateTemp = this._cameraMatrixState.clone();\n        this._cameraMatrixState.premultiply(this._translationMatrix);\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n        if (this.enableZoom) {\n          this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n        }\n        this._gizmoMatrixState.copy(gizmoStateTemp);\n        this._cameraMatrixState.copy(cameraStateTemp);\n      }\n    });\n    /**\n     * Draw a grid and add it to the scene\n     */\n    __publicField(this, \"drawGrid\", () => {\n      if (this.scene) {\n        const color = 8947848;\n        const multiplier = 3;\n        let size, divisions, maxLength, tick;\n        if (this.camera instanceof OrthographicCamera) {\n          const width = this.camera.right - this.camera.left;\n          const height = this.camera.bottom - this.camera.top;\n          maxLength = Math.max(width, height);\n          tick = maxLength / 20;\n          size = maxLength / this.camera.zoom * multiplier;\n          divisions = size / tick * this.camera.zoom;\n        } else if (this.camera instanceof PerspectiveCamera) {\n          const distance = this.camera.position.distanceTo(this._gizmos.position);\n          const halfFovV = MathUtils.DEG2RAD * this.camera.fov * 0.5;\n          const halfFovH = Math.atan(this.camera.aspect * Math.tan(halfFovV));\n          maxLength = Math.tan(Math.max(halfFovV, halfFovH)) * distance * 2;\n          tick = maxLength / 20;\n          size = maxLength * multiplier;\n          divisions = size / tick;\n        }\n        if (this._grid == null && this.camera) {\n          this._grid = new GridHelper(size, divisions, color, color);\n          this._grid.position.copy(this._gizmos.position);\n          this._gridPosition.copy(this._grid.position);\n          this._grid.quaternion.copy(this.camera.quaternion);\n          this._grid.rotateX(Math.PI * 0.5);\n          this.scene.add(this._grid);\n        }\n      }\n    });\n    __publicField(this, \"connect\", (domElement) => {\n      if (domElement === document) {\n        console.error(\n          'THREE.ArcballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.'\n        );\n      }\n      this.domElement = domElement;\n      this.domElement.style.touchAction = \"none\";\n      this.domElement.addEventListener(\"contextmenu\", this.onContextMenu);\n      this.domElement.addEventListener(\"pointerdown\", this.onPointerDown);\n      this.domElement.addEventListener(\"pointercancel\", this.onPointerCancel);\n      this.domElement.addEventListener(\"wheel\", this.onWheel);\n    });\n    /**\n     * Remove all listeners, stop animations and clean scene\n     */\n    __publicField(this, \"dispose\", () => {\n      var _a, _b, _c, _d, _e;\n      if (this._animationId != -1) {\n        window.cancelAnimationFrame(this._animationId);\n      }\n      (_a = this.domElement) == null ? void 0 : _a.removeEventListener(\"pointerdown\", this.onPointerDown);\n      (_b = this.domElement) == null ? void 0 : _b.removeEventListener(\"pointercancel\", this.onPointerCancel);\n      (_c = this.domElement) == null ? void 0 : _c.removeEventListener(\"wheel\", this.onWheel);\n      (_d = this.domElement) == null ? void 0 : _d.removeEventListener(\"contextmenu\", this.onContextMenu);\n      window.removeEventListener(\"pointermove\", this.onPointerMove);\n      window.removeEventListener(\"pointerup\", this.onPointerUp);\n      window.removeEventListener(\"resize\", this.onWindowResize);\n      (_e = this.scene) == null ? void 0 : _e.remove(this._gizmos);\n      this.disposeGrid();\n    });\n    /**\n     * remove the grid from the scene\n     */\n    __publicField(this, \"disposeGrid\", () => {\n      if (this._grid && this.scene) {\n        this.scene.remove(this._grid);\n        this._grid = null;\n      }\n    });\n    /**\n     * Compute the easing out cubic function for ease out effect in animation\n     * @param {Number} t The absolute progress of the animation in the bound of 0 (beginning of the) and 1 (ending of animation)\n     * @returns {Number} Result of easing out cubic at time t\n     */\n    __publicField(this, \"easeOutCubic\", (t) => {\n      return 1 - Math.pow(1 - t, 3);\n    });\n    /**\n     * Make rotation gizmos more or less visible\n     * @param {Boolean} isActive If true, make gizmos more visible\n     */\n    __publicField(this, \"activateGizmos\", (isActive) => {\n      for (const gizmo of this._gizmos.children) {\n        ;\n        gizmo.material.setValues({ opacity: isActive ? 1 : 0.6 });\n      }\n    });\n    /**\n     * Calculate the cursor position in NDC\n     * @param {number} x Cursor horizontal coordinate within the canvas\n     * @param {number} y Cursor vertical coordinate within the canvas\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @returns {Vector2} Cursor normalized position inside the canvas\n     */\n    __publicField(this, \"getCursorNDC\", (cursorX, cursorY, canvas) => {\n      const canvasRect = canvas.getBoundingClientRect();\n      this._v2_1.setX((cursorX - canvasRect.left) / canvasRect.width * 2 - 1);\n      this._v2_1.setY((canvasRect.bottom - cursorY) / canvasRect.height * 2 - 1);\n      return this._v2_1.clone();\n    });\n    /**\n     * Calculate the cursor position inside the canvas x/y coordinates with the origin being in the center of the canvas\n     * @param {Number} x Cursor horizontal coordinate within the canvas\n     * @param {Number} y Cursor vertical coordinate within the canvas\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @returns {Vector2} Cursor position inside the canvas\n     */\n    __publicField(this, \"getCursorPosition\", (cursorX, cursorY, canvas) => {\n      this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas));\n      if (this.camera instanceof OrthographicCamera) {\n        this._v2_1.x *= (this.camera.right - this.camera.left) * 0.5;\n        this._v2_1.y *= (this.camera.top - this.camera.bottom) * 0.5;\n      }\n      return this._v2_1.clone();\n    });\n    /**\n     * Set the camera to be controlled\n     * @param {Camera} camera The virtual camera to be controlled\n     */\n    __publicField(this, \"setCamera\", (camera) => {\n      if (camera) {\n        camera.lookAt(this.target);\n        camera.updateMatrix();\n        if (camera instanceof PerspectiveCamera) {\n          this._fov0 = camera.fov;\n          this._fovState = camera.fov;\n        }\n        this._cameraMatrixState0.copy(camera.matrix);\n        this._cameraMatrixState.copy(this._cameraMatrixState0);\n        this._cameraProjectionState.copy(camera.projectionMatrix);\n        this._zoom0 = camera.zoom;\n        this._zoomState = this._zoom0;\n        this._initialNear = camera.near;\n        this._nearPos0 = camera.position.distanceTo(this.target) - camera.near;\n        this._nearPos = this._initialNear;\n        this._initialFar = camera.far;\n        this._farPos0 = camera.position.distanceTo(this.target) - camera.far;\n        this._farPos = this._initialFar;\n        this._up0.copy(camera.up);\n        this._upState.copy(camera.up);\n        this.camera = camera;\n        this.camera.updateProjectionMatrix();\n        const tbRadius = this.calculateTbRadius(camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        this.makeGizmos(this.target, this._tbRadius);\n      }\n    });\n    /**\n     * Creates the rotation gizmos matching trackball center and radius\n     * @param {Vector3} tbCenter The trackball center\n     * @param {number} tbRadius The trackball radius\n     */\n    __publicField(this, \"makeGizmos\", (tbCenter, tbRadius) => {\n      const curve = new EllipseCurve(0, 0, tbRadius, tbRadius);\n      const points = curve.getPoints(this._curvePts);\n      const curveGeometry = new BufferGeometry().setFromPoints(points);\n      const curveMaterialX = new LineBasicMaterial({ color: 16744576, fog: false, transparent: true, opacity: 0.6 });\n      const curveMaterialY = new LineBasicMaterial({ color: 8454016, fog: false, transparent: true, opacity: 0.6 });\n      const curveMaterialZ = new LineBasicMaterial({ color: 8421631, fog: false, transparent: true, opacity: 0.6 });\n      const gizmoX = new Line(curveGeometry, curveMaterialX);\n      const gizmoY = new Line(curveGeometry, curveMaterialY);\n      const gizmoZ = new Line(curveGeometry, curveMaterialZ);\n      const rotation = Math.PI * 0.5;\n      gizmoX.rotation.x = rotation;\n      gizmoY.rotation.y = rotation;\n      this._gizmoMatrixState0.identity().setPosition(tbCenter);\n      this._gizmoMatrixState.copy(this._gizmoMatrixState0);\n      if (this.camera && this.camera.zoom != 1) {\n        const size = 1 / this.camera.zoom;\n        this._scaleMatrix.makeScale(size, size, size);\n        this._translationMatrix.makeTranslation(-tbCenter.x, -tbCenter.y, -tbCenter.z);\n        this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix);\n        this._translationMatrix.makeTranslation(tbCenter.x, tbCenter.y, tbCenter.z);\n        this._gizmoMatrixState.premultiply(this._translationMatrix);\n      }\n      this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n      this._gizmos.clear();\n      this._gizmos.add(gizmoX);\n      this._gizmos.add(gizmoY);\n      this._gizmos.add(gizmoZ);\n    });\n    /**\n     * Perform animation for focus operation\n     * @param {Number} time Instant in which this function is called as performance.now()\n     * @param {Vector3} point Point of interest for focus operation\n     * @param {Matrix4} cameraMatrix Camera matrix\n     * @param {Matrix4} gizmoMatrix Gizmos matrix\n     */\n    __publicField(this, \"onFocusAnim\", (time, point, cameraMatrix, gizmoMatrix) => {\n      if (this._timeStart == -1) {\n        this._timeStart = time;\n      }\n      if (this._state == STATE.ANIMATION_FOCUS) {\n        const deltaTime = time - this._timeStart;\n        const animTime = deltaTime / this.focusAnimationTime;\n        this._gizmoMatrixState.copy(gizmoMatrix);\n        if (animTime >= 1) {\n          this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n          this.focus(point, this.scaleFactor);\n          this._timeStart = -1;\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        } else {\n          const amount = this.easeOutCubic(animTime);\n          const size = 1 - amount + this.scaleFactor * amount;\n          this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n          this.focus(point, size, amount);\n          this.dispatchEvent(_changeEvent);\n          const self = this;\n          this._animationId = window.requestAnimationFrame(function(t) {\n            self.onFocusAnim(t, point, cameraMatrix, gizmoMatrix.clone());\n          });\n        }\n      } else {\n        this._animationId = -1;\n        this._timeStart = -1;\n      }\n    });\n    /**\n     * Perform animation for rotation operation\n     * @param {Number} time Instant in which this function is called as performance.now()\n     * @param {Vector3} rotationAxis Rotation axis\n     * @param {number} w0 Initial angular velocity\n     */\n    __publicField(this, \"onRotationAnim\", (time, rotationAxis, w0) => {\n      if (this._timeStart == -1) {\n        this._anglePrev = 0;\n        this._angleCurrent = 0;\n        this._timeStart = time;\n      }\n      if (this._state == STATE.ANIMATION_ROTATE) {\n        const deltaTime = (time - this._timeStart) / 1e3;\n        const w = w0 + -this.dampingFactor * deltaTime;\n        if (w > 0) {\n          this._angleCurrent = 0.5 * -this.dampingFactor * Math.pow(deltaTime, 2) + w0 * deltaTime + 0;\n          this.applyTransformMatrix(this.rotate(rotationAxis, this._angleCurrent));\n          this.dispatchEvent(_changeEvent);\n          const self = this;\n          this._animationId = window.requestAnimationFrame(function(t) {\n            self.onRotationAnim(t, rotationAxis, w0);\n          });\n        } else {\n          this._animationId = -1;\n          this._timeStart = -1;\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      } else {\n        this._animationId = -1;\n        this._timeStart = -1;\n        if (this._state != STATE.ROTATE) {\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      }\n    });\n    /**\n     * Perform pan operation moving camera between two points\n     * @param {Vector3} p0 Initial point\n     * @param {Vector3} p1 Ending point\n     * @param {Boolean} adjust If movement should be adjusted considering camera distance (Perspective only)\n     */\n    __publicField(this, \"pan\", (p0, p1, adjust = false) => {\n      if (this.camera) {\n        const movement = p0.clone().sub(p1);\n        if (this.camera instanceof OrthographicCamera) {\n          movement.multiplyScalar(1 / this.camera.zoom);\n        }\n        if (this.camera instanceof PerspectiveCamera && adjust) {\n          this._v3_1.setFromMatrixPosition(this._cameraMatrixState0);\n          this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);\n          const distanceFactor = this._v3_1.distanceTo(this._v3_2) / this.camera.position.distanceTo(this._gizmos.position);\n          movement.multiplyScalar(1 / distanceFactor);\n        }\n        this._v3_1.set(movement.x, movement.y, 0).applyQuaternion(this.camera.quaternion);\n        this._m4_1.makeTranslation(this._v3_1.x, this._v3_1.y, this._v3_1.z);\n        this.setTransformationMatrices(this._m4_1, this._m4_1);\n      }\n      return _transformation;\n    });\n    /**\n     * Reset trackball\n     */\n    __publicField(this, \"reset\", () => {\n      if (this.camera) {\n        this.camera.zoom = this._zoom0;\n        if (this.camera instanceof PerspectiveCamera) {\n          this.camera.fov = this._fov0;\n        }\n        this.camera.near = this._nearPos;\n        this.camera.far = this._farPos;\n        this._cameraMatrixState.copy(this._cameraMatrixState0);\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n        this.camera.up.copy(this._up0);\n        this.camera.updateMatrix();\n        this.camera.updateProjectionMatrix();\n        this._gizmoMatrixState.copy(this._gizmoMatrixState0);\n        this._gizmoMatrixState0.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n        this._gizmos.updateMatrix();\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        this.makeGizmos(this._gizmos.position, this._tbRadius);\n        this.camera.lookAt(this._gizmos.position);\n        this.updateTbState(STATE.IDLE, false);\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    /**\n     * Rotate the camera around an axis passing by trackball's center\n     * @param {Vector3} axis Rotation axis\n     * @param {number} angle Angle in radians\n     * @returns {Object} Object with 'camera' field containing transformation matrix resulting from the operation to be applied to the camera\n     */\n    __publicField(this, \"rotate\", (axis, angle) => {\n      const point = this._gizmos.position;\n      this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n      this._rotationMatrix.makeRotationAxis(axis, -angle);\n      this._m4_1.makeTranslation(point.x, point.y, point.z);\n      this._m4_1.multiply(this._rotationMatrix);\n      this._m4_1.multiply(this._translationMatrix);\n      this.setTransformationMatrices(this._m4_1);\n      return _transformation;\n    });\n    __publicField(this, \"copyState\", () => {\n      if (this.camera) {\n        const state = JSON.stringify(\n          this.camera instanceof OrthographicCamera ? {\n            arcballState: {\n              cameraFar: this.camera.far,\n              cameraMatrix: this.camera.matrix,\n              cameraNear: this.camera.near,\n              cameraUp: this.camera.up,\n              cameraZoom: this.camera.zoom,\n              gizmoMatrix: this._gizmos.matrix\n            }\n          } : {\n            arcballState: {\n              cameraFar: this.camera.far,\n              cameraFov: this.camera.fov,\n              cameraMatrix: this.camera.matrix,\n              cameraNear: this.camera.near,\n              cameraUp: this.camera.up,\n              cameraZoom: this.camera.zoom,\n              gizmoMatrix: this._gizmos.matrix\n            }\n          }\n        );\n        navigator.clipboard.writeText(state);\n      }\n    });\n    __publicField(this, \"pasteState\", () => {\n      const self = this;\n      navigator.clipboard.readText().then(function resolved(value) {\n        self.setStateFromJSON(value);\n      });\n    });\n    /**\n     * Save the current state of the control. This can later be recovered with .reset\n     */\n    __publicField(this, \"saveState\", () => {\n      if (!this.camera)\n        return;\n      this._cameraMatrixState0.copy(this.camera.matrix);\n      this._gizmoMatrixState0.copy(this._gizmos.matrix);\n      this._nearPos = this.camera.near;\n      this._farPos = this.camera.far;\n      this._zoom0 = this.camera.zoom;\n      this._up0.copy(this.camera.up);\n      if (this.camera instanceof PerspectiveCamera) {\n        this._fov0 = this.camera.fov;\n      }\n    });\n    /**\n     * Perform uniform scale operation around a given point\n     * @param {Number} size Scale factor\n     * @param {Vector3} point Point around which scale\n     * @param {Boolean} scaleGizmos If gizmos should be scaled (Perspective only)\n     * @returns {Object} Object with 'camera' and 'gizmo' fields containing transformation matrices resulting from the operation to be applied to the camera and gizmos\n     */\n    __publicField(this, \"applyScale\", (size, point, scaleGizmos = true) => {\n      if (!this.camera)\n        return;\n      const scalePoint = point.clone();\n      let sizeInverse = 1 / size;\n      if (this.camera instanceof OrthographicCamera) {\n        this.camera.zoom = this._zoomState;\n        this.camera.zoom *= size;\n        if (this.camera.zoom > this.maxZoom) {\n          this.camera.zoom = this.maxZoom;\n          sizeInverse = this._zoomState / this.maxZoom;\n        } else if (this.camera.zoom < this.minZoom) {\n          this.camera.zoom = this.minZoom;\n          sizeInverse = this._zoomState / this.minZoom;\n        }\n        this.camera.updateProjectionMatrix();\n        this._v3_1.setFromMatrixPosition(this._gizmoMatrixState);\n        this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n        this._translationMatrix.makeTranslation(-this._v3_1.x, -this._v3_1.y, -this._v3_1.z);\n        this._m4_2.makeTranslation(this._v3_1.x, this._v3_1.y, this._v3_1.z).multiply(this._scaleMatrix);\n        this._m4_2.multiply(this._translationMatrix);\n        scalePoint.sub(this._v3_1);\n        const amount = scalePoint.clone().multiplyScalar(sizeInverse);\n        scalePoint.sub(amount);\n        this._m4_1.makeTranslation(scalePoint.x, scalePoint.y, scalePoint.z);\n        this._m4_2.premultiply(this._m4_1);\n        this.setTransformationMatrices(this._m4_1, this._m4_2);\n        return _transformation;\n      }\n      if (this.camera instanceof PerspectiveCamera) {\n        this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n        this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n        let distance = this._v3_1.distanceTo(scalePoint);\n        let amount = distance - distance * sizeInverse;\n        const newDistance = distance - amount;\n        if (newDistance < this.minDistance) {\n          sizeInverse = this.minDistance / distance;\n          amount = distance - distance * sizeInverse;\n        } else if (newDistance > this.maxDistance) {\n          sizeInverse = this.maxDistance / distance;\n          amount = distance - distance * sizeInverse;\n        }\n        let direction = scalePoint.clone().sub(this._v3_1).normalize().multiplyScalar(amount);\n        this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n        if (scaleGizmos) {\n          const pos = this._v3_2;\n          distance = pos.distanceTo(scalePoint);\n          amount = distance - distance * sizeInverse;\n          direction = scalePoint.clone().sub(this._v3_2).normalize().multiplyScalar(amount);\n          this._translationMatrix.makeTranslation(pos.x, pos.y, pos.z);\n          this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n          this._m4_2.makeTranslation(direction.x, direction.y, direction.z).multiply(this._translationMatrix);\n          this._m4_2.multiply(this._scaleMatrix);\n          this._translationMatrix.makeTranslation(-pos.x, -pos.y, -pos.z);\n          this._m4_2.multiply(this._translationMatrix);\n          this.setTransformationMatrices(this._m4_1, this._m4_2);\n        } else {\n          this.setTransformationMatrices(this._m4_1);\n        }\n        return _transformation;\n      }\n    });\n    /**\n     * Set camera fov\n     * @param {Number} value fov to be setted\n     */\n    __publicField(this, \"setFov\", (value) => {\n      if (this.camera instanceof PerspectiveCamera) {\n        this.camera.fov = MathUtils.clamp(value, this.minFov, this.maxFov);\n        this.camera.updateProjectionMatrix();\n      }\n    });\n    /**\n     * Set the trackball's center point\n     * @param {Number} x X coordinate\n     * @param {Number} y Y coordinate\n     * @param {Number} z Z coordinate\n     */\n    __publicField(this, \"setTarget\", (x, y, z) => {\n      if (this.camera) {\n        this.target.set(x, y, z);\n        this._gizmos.position.set(x, y, z);\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        this.makeGizmos(this.target, this._tbRadius);\n        this.camera.lookAt(this.target);\n      }\n    });\n    /**\n     * Rotate camera around its direction axis passing by a given point by a given angle\n     * @param {Vector3} point The point where the rotation axis is passing trough\n     * @param {Number} angle Angle in radians\n     * @returns The computed transormation matix\n     */\n    __publicField(this, \"zRotate\", (point, angle) => {\n      this._rotationMatrix.makeRotationAxis(this._rotationAxis, angle);\n      this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n      this._m4_1.makeTranslation(point.x, point.y, point.z);\n      this._m4_1.multiply(this._rotationMatrix);\n      this._m4_1.multiply(this._translationMatrix);\n      this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(point);\n      this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis, angle);\n      this._v3_2.sub(this._v3_1);\n      this._m4_2.makeTranslation(this._v3_2.x, this._v3_2.y, this._v3_2.z);\n      this.setTransformationMatrices(this._m4_1, this._m4_2);\n      return _transformation;\n    });\n    /**\n     * Unproject the cursor on the 3D object surface\n     * @param {Vector2} cursor Cursor coordinates in NDC\n     * @param {Camera} camera Virtual camera\n     * @returns {Vector3} The point of intersection with the model, if exist, null otherwise\n     */\n    __publicField(this, \"unprojectOnObj\", (cursor, camera) => {\n      if (!this.scene)\n        return null;\n      const raycaster = new Raycaster();\n      raycaster.near = camera.near;\n      raycaster.far = camera.far;\n      raycaster.setFromCamera(cursor, camera);\n      const intersect = raycaster.intersectObjects(this.scene.children, true);\n      for (let i = 0; i < intersect.length; i++) {\n        if (intersect[i].object.uuid != this._gizmos.uuid && intersect[i].face) {\n          return intersect[i].point.clone();\n        }\n      }\n      return null;\n    });\n    /**\n     * Unproject the cursor on the trackball surface\n     * @param {Camera} camera The virtual camera\n     * @param {Number} cursorX Cursor horizontal coordinate on screen\n     * @param {Number} cursorY Cursor vertical coordinate on screen\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @param {number} tbRadius The trackball radius\n     * @returns {Vector3} The unprojected point on the trackball surface\n     */\n    __publicField(this, \"unprojectOnTbSurface\", (camera, cursorX, cursorY, canvas, tbRadius) => {\n      if (camera instanceof OrthographicCamera) {\n        this._v2_1.copy(this.getCursorPosition(cursorX, cursorY, canvas));\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, 0);\n        const x2 = Math.pow(this._v2_1.x, 2);\n        const y2 = Math.pow(this._v2_1.y, 2);\n        const r2 = Math.pow(this._tbRadius, 2);\n        if (x2 + y2 <= r2 * 0.5) {\n          this._v3_1.setZ(Math.sqrt(r2 - (x2 + y2)));\n        } else {\n          this._v3_1.setZ(r2 * 0.5 / Math.sqrt(x2 + y2));\n        }\n        return this._v3_1;\n      }\n      if (camera instanceof PerspectiveCamera) {\n        this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas));\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, -1);\n        this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n        const rayDir = this._v3_1.clone().normalize();\n        const cameraGizmoDistance = camera.position.distanceTo(this._gizmos.position);\n        const radius2 = Math.pow(tbRadius, 2);\n        const h = this._v3_1.z;\n        const l = Math.sqrt(Math.pow(this._v3_1.x, 2) + Math.pow(this._v3_1.y, 2));\n        if (l == 0) {\n          rayDir.set(this._v3_1.x, this._v3_1.y, tbRadius);\n          return rayDir;\n        }\n        const m = h / l;\n        const q = cameraGizmoDistance;\n        let a = Math.pow(m, 2) + 1;\n        let b = 2 * m * q;\n        let c = Math.pow(q, 2) - radius2;\n        let delta = Math.pow(b, 2) - 4 * a * c;\n        if (delta >= 0) {\n          this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n          this._v2_1.setY(m * this._v2_1.x + q);\n          const angle = MathUtils.RAD2DEG * this._v2_1.angle();\n          if (angle >= 45) {\n            const rayLength2 = Math.sqrt(Math.pow(this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - this._v2_1.y, 2));\n            rayDir.multiplyScalar(rayLength2);\n            rayDir.z += cameraGizmoDistance;\n            return rayDir;\n          }\n        }\n        a = m;\n        b = q;\n        c = -radius2 * 0.5;\n        delta = Math.pow(b, 2) - 4 * a * c;\n        this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n        this._v2_1.setY(m * this._v2_1.x + q);\n        const rayLength = Math.sqrt(Math.pow(this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - this._v2_1.y, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z += cameraGizmoDistance;\n        return rayDir;\n      }\n    });\n    /**\n     * Unproject the cursor on the plane passing through the center of the trackball orthogonal to the camera\n     * @param {Camera} camera The virtual camera\n     * @param {Number} cursorX Cursor horizontal coordinate on screen\n     * @param {Number} cursorY Cursor vertical coordinate on screen\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @param {Boolean} initialDistance If initial distance between camera and gizmos should be used for calculations instead of current (Perspective only)\n     * @returns {Vector3} The unprojected point on the trackball plane\n     */\n    __publicField(this, \"unprojectOnTbPlane\", (camera, cursorX, cursorY, canvas, initialDistance = false) => {\n      if (camera instanceof OrthographicCamera) {\n        this._v2_1.copy(this.getCursorPosition(cursorX, cursorY, canvas));\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, 0);\n        return this._v3_1.clone();\n      }\n      if (camera instanceof PerspectiveCamera) {\n        this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas));\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, -1);\n        this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n        const rayDir = this._v3_1.clone().normalize();\n        const h = this._v3_1.z;\n        const l = Math.sqrt(Math.pow(this._v3_1.x, 2) + Math.pow(this._v3_1.y, 2));\n        let cameraGizmoDistance;\n        if (initialDistance) {\n          cameraGizmoDistance = this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0));\n        } else {\n          cameraGizmoDistance = camera.position.distanceTo(this._gizmos.position);\n        }\n        if (l == 0) {\n          rayDir.set(0, 0, 0);\n          return rayDir;\n        }\n        const m = h / l;\n        const q = cameraGizmoDistance;\n        const x = -q / m;\n        const rayLength = Math.sqrt(Math.pow(q, 2) + Math.pow(x, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z = 0;\n        return rayDir;\n      }\n    });\n    /**\n     * Update camera and gizmos state\n     */\n    __publicField(this, \"updateMatrixState\", () => {\n      if (!this.camera)\n        return;\n      this._cameraMatrixState.copy(this.camera.matrix);\n      this._gizmoMatrixState.copy(this._gizmos.matrix);\n      if (this.camera instanceof OrthographicCamera) {\n        this._cameraProjectionState.copy(this.camera.projectionMatrix);\n        this.camera.updateProjectionMatrix();\n        this._zoomState = this.camera.zoom;\n      }\n      if (this.camera instanceof PerspectiveCamera) {\n        this._fovState = this.camera.fov;\n      }\n    });\n    /**\n     * Update the trackball FSA\n     * @param {STATE} newState New state of the FSA\n     * @param {Boolean} updateMatrices If matriices state should be updated\n     */\n    __publicField(this, \"updateTbState\", (newState, updateMatrices) => {\n      this._state = newState;\n      if (updateMatrices) {\n        this.updateMatrixState();\n      }\n    });\n    __publicField(this, \"update\", () => {\n      const EPS = 1e-6;\n      if (!this.target.equals(this._currentTarget) && this.camera) {\n        this._gizmos.position.set(this.target.x, this.target.y, this.target.z);\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        this.makeGizmos(this.target, this._tbRadius);\n        this._currentTarget.copy(this.target);\n      }\n      if (!this.camera)\n        return;\n      if (this.camera instanceof OrthographicCamera) {\n        if (this.camera.zoom > this.maxZoom || this.camera.zoom < this.minZoom) {\n          const newZoom = MathUtils.clamp(this.camera.zoom, this.minZoom, this.maxZoom);\n          this.applyTransformMatrix(this.applyScale(newZoom / this.camera.zoom, this._gizmos.position, true));\n        }\n      }\n      if (this.camera instanceof PerspectiveCamera) {\n        const distance = this.camera.position.distanceTo(this._gizmos.position);\n        if (distance > this.maxDistance + EPS || distance < this.minDistance - EPS) {\n          const newDistance = MathUtils.clamp(distance, this.minDistance, this.maxDistance);\n          this.applyTransformMatrix(this.applyScale(newDistance / distance, this._gizmos.position));\n          this.updateMatrixState();\n        }\n        if (this.camera.fov < this.minFov || this.camera.fov > this.maxFov) {\n          this.camera.fov = MathUtils.clamp(this.camera.fov, this.minFov, this.maxFov);\n          this.camera.updateProjectionMatrix();\n        }\n        const oldRadius = this._tbRadius;\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        if (oldRadius < this._tbRadius - EPS || oldRadius > this._tbRadius + EPS) {\n          const scale = (this._gizmos.scale.x + this._gizmos.scale.y + this._gizmos.scale.z) / 3;\n          const newRadius = this._tbRadius / scale;\n          const curve = new EllipseCurve(0, 0, newRadius, newRadius);\n          const points = curve.getPoints(this._curvePts);\n          const curveGeometry = new BufferGeometry().setFromPoints(points);\n          for (const gizmo in this._gizmos.children) {\n            const child = this._gizmos.children[gizmo];\n            child.geometry = curveGeometry;\n          }\n        }\n      }\n      this.camera.lookAt(this._gizmos.position);\n    });\n    __publicField(this, \"setStateFromJSON\", (json) => {\n      const state = JSON.parse(json);\n      if (state.arcballState && this.camera) {\n        this._cameraMatrixState.fromArray(state.arcballState.cameraMatrix.elements);\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n        this.camera.up.copy(state.arcballState.cameraUp);\n        this.camera.near = state.arcballState.cameraNear;\n        this.camera.far = state.arcballState.cameraFar;\n        this.camera.zoom = state.arcballState.cameraZoom;\n        if (this.camera instanceof PerspectiveCamera) {\n          this.camera.fov = state.arcballState.cameraFov;\n        }\n        this._gizmoMatrixState.fromArray(state.arcballState.gizmoMatrix.elements);\n        this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n        this.camera.updateMatrix();\n        this.camera.updateProjectionMatrix();\n        this._gizmos.updateMatrix();\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        const gizmoTmp = new Matrix4().copy(this._gizmoMatrixState0);\n        this.makeGizmos(this._gizmos.position, this._tbRadius);\n        this._gizmoMatrixState0.copy(gizmoTmp);\n        this.camera.lookAt(this._gizmos.position);\n        this.updateTbState(STATE.IDLE, false);\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    this.camera = null;\n    this.domElement = domElement;\n    this.scene = scene;\n    this.mouseActions = [];\n    this._mouseOp = null;\n    this._v2_1 = new Vector2();\n    this._v3_1 = new Vector3();\n    this._v3_2 = new Vector3();\n    this._m4_1 = new Matrix4();\n    this._m4_2 = new Matrix4();\n    this._quat = new Quaternion();\n    this._translationMatrix = new Matrix4();\n    this._rotationMatrix = new Matrix4();\n    this._scaleMatrix = new Matrix4();\n    this._rotationAxis = new Vector3();\n    this._cameraMatrixState = new Matrix4();\n    this._cameraProjectionState = new Matrix4();\n    this._fovState = 1;\n    this._upState = new Vector3();\n    this._zoomState = 1;\n    this._nearPos = 0;\n    this._farPos = 0;\n    this._gizmoMatrixState = new Matrix4();\n    this._up0 = new Vector3();\n    this._zoom0 = 1;\n    this._fov0 = 0;\n    this._initialNear = 0;\n    this._nearPos0 = 0;\n    this._initialFar = 0;\n    this._farPos0 = 0;\n    this._cameraMatrixState0 = new Matrix4();\n    this._gizmoMatrixState0 = new Matrix4();\n    this._button = -1;\n    this._touchStart = [];\n    this._touchCurrent = [];\n    this._input = INPUT.NONE;\n    this._switchSensibility = 32;\n    this._startFingerDistance = 0;\n    this._currentFingerDistance = 0;\n    this._startFingerRotation = 0;\n    this._currentFingerRotation = 0;\n    this._devPxRatio = 0;\n    this._downValid = true;\n    this._nclicks = 0;\n    this._downEvents = [];\n    this._clickStart = 0;\n    this._maxDownTime = 250;\n    this._maxInterval = 300;\n    this._posThreshold = 24;\n    this._movementThreshold = 24;\n    this._currentCursorPosition = new Vector3();\n    this._startCursorPosition = new Vector3();\n    this._grid = null;\n    this._gridPosition = new Vector3();\n    this._gizmos = new Group();\n    this._curvePts = 128;\n    this._timeStart = -1;\n    this._animationId = -1;\n    this.focusAnimationTime = 500;\n    this._timePrev = 0;\n    this._timeCurrent = 0;\n    this._anglePrev = 0;\n    this._angleCurrent = 0;\n    this._cursorPosPrev = new Vector3();\n    this._cursorPosCurr = new Vector3();\n    this._wPrev = 0;\n    this._wCurr = 0;\n    this.adjustNearFar = false;\n    this.scaleFactor = 1.1;\n    this.dampingFactor = 25;\n    this.wMax = 20;\n    this.enableAnimations = true;\n    this.enableGrid = false;\n    this.cursorZoom = false;\n    this.minFov = 5;\n    this.maxFov = 90;\n    this.enabled = true;\n    this.enablePan = true;\n    this.enableRotate = true;\n    this.enableZoom = true;\n    this.minDistance = 0;\n    this.maxDistance = Infinity;\n    this.minZoom = 0;\n    this.maxZoom = Infinity;\n    this.target = new Vector3(0, 0, 0);\n    this._currentTarget = new Vector3(0, 0, 0);\n    this._tbRadius = 1;\n    this._state = STATE.IDLE;\n    this.setCamera(camera);\n    if (this.scene) {\n      this.scene.add(this._gizmos);\n    }\n    this._devPxRatio = window.devicePixelRatio;\n    this.initializeMouseActions();\n    if (this.domElement)\n      this.connect(this.domElement);\n    window.addEventListener(\"resize\", this.onWindowResize);\n  }\n  /**\n   * Apply a transformation matrix, to the camera and gizmos\n   * @param {Object} transformation Object containing matrices to apply to camera and gizmos\n   */\n  applyTransformMatrix(transformation) {\n    if ((transformation == null ? void 0 : transformation.camera) && this.camera) {\n      this._m4_1.copy(this._cameraMatrixState).premultiply(transformation.camera);\n      this._m4_1.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n      this.camera.updateMatrix();\n      if (this._state == STATE.ROTATE || this._state == STATE.ZROTATE || this._state == STATE.ANIMATION_ROTATE) {\n        this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion);\n      }\n    }\n    if (transformation == null ? void 0 : transformation.gizmos) {\n      this._m4_1.copy(this._gizmoMatrixState).premultiply(transformation.gizmos);\n      this._m4_1.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n      this._gizmos.updateMatrix();\n    }\n    if ((this._state == STATE.SCALE || this._state == STATE.FOCUS || this._state == STATE.ANIMATION_FOCUS) && this.camera) {\n      const tbRadius = this.calculateTbRadius(this.camera);\n      if (tbRadius !== void 0) {\n        this._tbRadius = tbRadius;\n      }\n      if (this.adjustNearFar) {\n        const cameraDistance = this.camera.position.distanceTo(this._gizmos.position);\n        const bb = new Box3();\n        bb.setFromObject(this._gizmos);\n        const sphere = new Sphere();\n        bb.getBoundingSphere(sphere);\n        const adjustedNearPosition = Math.max(this._nearPos0, sphere.radius + sphere.center.length());\n        const regularNearPosition = cameraDistance - this._initialNear;\n        const minNearPos = Math.min(adjustedNearPosition, regularNearPosition);\n        this.camera.near = cameraDistance - minNearPos;\n        const adjustedFarPosition = Math.min(this._farPos0, -sphere.radius + sphere.center.length());\n        const regularFarPosition = cameraDistance - this._initialFar;\n        const minFarPos = Math.min(adjustedFarPosition, regularFarPosition);\n        this.camera.far = cameraDistance - minFarPos;\n        this.camera.updateProjectionMatrix();\n      } else {\n        let update = false;\n        if (this.camera.near != this._initialNear) {\n          this.camera.near = this._initialNear;\n          update = true;\n        }\n        if (this.camera.far != this._initialFar) {\n          this.camera.far = this._initialFar;\n          update = true;\n        }\n        if (update) {\n          this.camera.updateProjectionMatrix();\n        }\n      }\n    }\n  }\n  /**\n   * Set gizmos visibility\n   * @param {Boolean} value Value of gizmos visibility\n   */\n  setGizmosVisible(value) {\n    this._gizmos.visible = value;\n    this.dispatchEvent(_changeEvent);\n  }\n  /**\n   * Set values in transformation object\n   * @param {Matrix4} camera Transformation to be applied to the camera\n   * @param {Matrix4} gizmos Transformation to be applied to gizmos\n   */\n  setTransformationMatrices(camera = null, gizmos = null) {\n    if (camera) {\n      if (_transformation.camera) {\n        _transformation.camera.copy(camera);\n      } else {\n        _transformation.camera = camera.clone();\n      }\n    } else {\n      _transformation.camera = null;\n    }\n    if (gizmos) {\n      if (_transformation.gizmos) {\n        _transformation.gizmos.copy(gizmos);\n      } else {\n        _transformation.gizmos = gizmos.clone();\n      }\n    } else {\n      _transformation.gizmos = null;\n    }\n  }\n}\nexport {\n  ArcballControls\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}